(()=>{"use strict";var e={49:(e,t,s)=>{s.d(t,{A:()=>a});var i=s(601),n=s.n(i),r=s(314),o=s.n(r)()(n());o.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap);"]),o.push([e.id,':root{--yasl-editor-bg: rgba(255, 255, 255, 0.03);--yasl-row-active-bg: rgba(255, 255, 255, 0.03);--yasl-text-color: #a6a6a6;--yasl-editor-selection-color: rgba(70, 136, 255, 0.42);--yasl-identifier-color: #7bfbdd;--yasl-symbol-color: #dccaca;--yasl-operator-color: var(--yasl-text-color);--yasl-comment-color: #616161;--yasl-keyword-color: #e4ab85;--yasl-whitespace-color: #fff;--yasl-string-color: #a8ff8d;--yasl-error-color: #ef4848;--yasl-ide-indent-color: rgba(255, 255, 255, 0.23);--yasl-repl-border-radius: 10px;--yasl-editor-font-size: 1rem;--yasl-caret-color: #fff;--yasl-loader-bg: rgb(53, 53, 53);--yasl-editor-line-height: 2}.yasl-editor-wrapper{width:100%;overflow:hidden;gap:2px;display:flex;user-select:none;background:var(--yasl-editor-bg)}.yasl-editor-wrapper *{line-height:var(--yasl-editor-line-height);box-sizing:border-box;font-family:"JetBrains Mono",monospace;font-size:var(--yasl-editor-font-size);user-select:none}.yasl-editor-gutter{width:fit-content;padding-right:1.5em;padding-left:.5em;border-right:1px solid var(--yasl-ide-indent-color)}.yasl-editor{caret-color:rgba(0,0,0,0) !important;width:100%;min-height:fit-content;display:flex;flex-direction:column;outline:none;font-family:"JetBrains Mono",monospace;overflow:scroll;cursor:text;line-height:var(--yasl-editor-line-height)}.yasl-editor .yasl-ide-loader{width:100%;height:100%;background:var(--yasl-loader-bg);position:absolute;z-index:1;opacity:1;transition:opacity 100ms linear,visibility 150ms linear}.yasl-editor.ready{pointer-events:auto}.yasl-editor.ready .yasl-ide-loader{opacity:0;visibility:hidden}.yasl-editor:focus .caret{display:block}.yasl-editor .caret{display:none;position:absolute;top:0;left:0;width:2px;padding-left:1px;height:1em;background:var(--yasl-caret-color);will-change:opacity,top,left;transition:top 50ms linear,left 50ms linear;animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}.yasl-editor .caret.typing{animation:none}.yasl-editor .yasl-ide-selection-el{background-color:var(--yasl-editor-selection-color);position:absolute;will-change:width,top,left}.yasl-editor .yasl-editor-rows-wrapper{min-width:fit-content;height:fit-content}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row{position:relative;min-width:100%;width:max-content;height:min-content;outline:none;min-height:var(--yasl-editor-font-size);padding:0;white-space:pre;align-content:center}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row.active{background:var(--yasl-row-active-bg)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .identifier{color:var(--yasl-identifier-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .whitespace{color:var(--yasl-whitespace-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .keyword{color:var(--yasl-keyword-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .operator{color:var(--yasl-operator-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .string{color:var(--yasl-string-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .number{color:var(--yasl-string-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .comment{color:var(--yasl-comment-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .symbol{color:var(--yasl-symbol-color)}.yasl-editor .yasl-editor-rows-wrapper .yasl-editor-row .error{color:var(--yasl-error-color)}',""]);const a=o},56:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function s(e){for(var s=-1,i=0;i<t.length;i++)if(t[i].identifier===e){s=i;break}return s}function i(e,i){for(var r={},o=[],a=0;a<e.length;a++){var h=e[a],c=i.base?h[0]+i.base:h[0],d=r[c]||0,l="".concat(c," ").concat(d);r[c]=d+1;var u=s(l),_={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==u)t[u].references++,t[u].updater(_);else{var m=n(_,i);i.byIndex=a,t.splice(a,0,{identifier:l,updater:m,references:1})}o.push(l)}return o}function n(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,n){var r=i(e=e||[],n=n||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=s(r[o]);t[a].references--}for(var h=i(e,n),c=0;c<r.length;c++){var d=s(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=h}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var s="",i=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),i&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),i&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s}).join("")},t.i=function(e,s,i,n,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(i)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);i&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),n&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=n):d[4]="".concat(n)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,s){var i=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,n&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.nc=void 0;var i,n,r,o,a,h,c,d,l=s(72),u=s.n(l),_=s(825),m=s.n(_),p=s(659),g=s.n(p),w=s(56),f=s.n(w),y=s(540),x=s.n(y),E=s(113),T=s.n(E),N=s(49),v={};v.styleTagTransform=T(),v.setAttributes=f(),v.insert=g().bind(null,"head"),v.domAPI=m(),v.insertStyleElement=x(),u()(N.A,v),N.A&&N.A.locals&&N.A.locals;class C{static roundedClamp(e,t,s){return C.clamp(Math.round(e),t,s)}static clamp(e,t,s){return Math.max(Math.min(e,s),t)}static round(e,t){return Math.round(e*10**t)/10**t}}class b{constructor(e,t){this.primary_row=t,this.spawned_carets=[],this.is_typing_timer_id=null,this._char_width=0,this._line_height=0,this.primary_caret=new S(e)}get char_width(){return this._char_width}get line_height(){return this._line_height}moveCol(e){const t=this.primary_row.raw.length,s=C.clamp(this.primary_caret.column+e,0,t);this.primary_caret.setColumn(s),this.primary_row.setColumn(s),this.posChanged()}setColumn(e){const t=this.primary_row.raw.length;let s;s=e>=0?C.clamp(e,0,t):C.clamp(t-e+1,0,t),this.primary_caret.setColumn(s),this.primary_row.setColumn(s),this.posChanged()}setRow(e){this.primary_row=e;const t=this.primary_row.raw.length,s=C.clamp(this.primary_caret.column,0,t);this.primary_row.setColumn(s),this.primary_caret.setColumn(s),this.primary_caret.setRow(this.primary_row.getDomNode()),this.posChanged()}setFontMetrics(e,t){this.primary_caret.setCharWidth(e),this.primary_caret.setLineHeight(t),console.log("IDE Font metrics updated from",this._char_width,"to",e),this._char_width=e,this._line_height=t,this.primary_caret.updateCaretPosition()}moveColToWordEnd(){const e=this.primary_row.tokens,t=this.primary_caret.column;for(const s of e)if(t<s.end){this.setColumn(s.end);break}}isAtEnd(){return this.primary_caret.column===this.primary_row.raw.length}isAtStart(){return 0===this.primary_caret.column}posChanged(){this.is_typing_timer_id&&clearTimeout(this.is_typing_timer_id),this.primary_caret.typing=!0,this.is_typing_timer_id=setTimeout(()=>{this.primary_caret.typing=!1},1e3)}}class S{constructor(e){this.parent=e,this.caret=document.createElement("div"),this.char_width=10,this.line_height=10,this.text_before_caret="",this._column=0,this._row=0,this._typing=!1,this.row_el=null,this.caret.classList.add("caret"),e.append(this.caret),e.style.position="relative"}get row(){return this._row}get column(){return this._column}get typing(){return this._typing}set typing(e){this._typing=e,e?this.caret.classList.add("typing"):this.caret.classList.remove("typing")}setRow(e){this.row_el=e,this.updateCaretPosition()}setColumn(e){this._column=e,this.updateCaretPosition()}updateCaretPosition(){this.row_el&&(this.caret.style.top=this.row_el.offsetTop.toString()+"px",this.caret.style.left=(this._column*this.char_width).toString()+"px")}moveBy(e){this._column=Math.max(this._column+e,0),this.updateCaretPosition()}setLineHeight(e){this.line_height=e,this.caret.style.height=this.line_height+"px"}setCharWidth(e){this.char_width=e}}!function(e){e.Alt="alt",e.CapsLock="capsLock",e.Ctrl="control",e.Backspace="backspace",e.Delete="delete",e.Undefined="inidentified",e.Shift="shift",e.Enter="enter",e.Tab="tab",e.Space=" ",e.ARROW_DOWN="arrowdown",e.ARROW_UP="arrowup",e.ARROW_LEFT="arrowleft",e.ARROW_RIGHT="arrowright",e.Home="home",e.End="end",e.COPY="ctrl+c"}(i||(i={}));class I{constructor(e,t){this.keybinding_handler=t,this.is_shortcut_key=!1,this.prev_keys_pressed=[],e.onkeydown=e=>{this.handleKeyPress(e),e.preventDefault(),e.stopImmediatePropagation()},window.addEventListener("keyup",()=>{})}handleKeyPress(e){let t=!1;const s=[];if(e.ctrlKey&&s.push("ctrl"),e.metaKey&&s.push("meta"),e.altKey&&s.push("alt"),e.shiftKey&&s.push("shift"),e.key&&(s.length>1||1===s.length&&"shift"!==s[0])&&(t=!0,s.push(e.key.toLowerCase())),t){const e=s.join("+");this.prev_keys_pressed.join("+")!==e&&(this.keybinding_handler(e),this.prev_keys_pressed=s)}else this.keybinding_handler(e.key)}}class R{constructor(e,t){this.ide=t,this.anchor={line:0,col:0},this.head={line:0,col:0},this.anchor_el=document.createElement("div"),this.middle_el=document.createElement("div"),this.head_el=document.createElement("div"),this.single_selected_row=-1,e.append(this.anchor_el,this.middle_el,this.head_el),this.anchor_el.classList.add("yasl-ide-selection-el"),this.middle_el.classList.add("yasl-ide-selection-el"),this.head_el.classList.add("yasl-ide-selection-el")}moveHead(e,t){this.head.line=t,this.head.col=e,this.render()}setAnchor(e,t){this.clear();const s=this.ide.getMaxColumn(t);this.anchor.col=Math.min(e,s),this.anchor.line=t}clear(){this.head.col=0,this.head.line=0,this.anchor.col=0,this.anchor.line=0,this.single_selected_row=-1,this.anchor_el.style="",this.middle_el.style="",this.head_el.style=""}isSelected(){if(this.single_selected_row>=0)return!0;const e=this.anchor_el.getAttribute("style");return"string"==typeof e&&e.length>0}getStart(){return this.anchor.line===this.head.line?this.anchor.col<this.head.col?this.anchor:this.head:this.anchor.line<this.head.line?this.anchor:this.head}getEnd(){return this.anchor.line===this.head.line?this.anchor.col<this.head.col?this.head:this.anchor:this.anchor.line<this.head.line?this.head:this.anchor}selectRow(e){this.clear(),this.single_selected_row=e,this.render()}updateBounds(){}render(){if(this.single_selected_row>=0){const e=this.ide.caret_manager.line_height;return this.anchor_el.style.left="0",this.anchor_el.style.top=this.single_selected_row*e+"px",this.anchor_el.style.width=this.ide.row_wrapper_rect.width+"px",void(this.anchor_el.style.height=e+"px")}if(this.head.col===this.anchor.col&&this.head.line===this.anchor.line)return this.anchor_el.style="",this.middle_el.style="",void(this.head_el.style="");const e=this.ide.caret_manager.char_width,t=this.ide.caret_manager.line_height,s=this.ide.row_wrapper_rect.width;if(this.anchor_el.style.height=t+"px",this.anchor_el.style.top=this.anchor.line*t+"px",this.head.line===this.anchor.line){let t,s;this.head.col>this.anchor.col?(t=this.anchor.col,s=this.head.col):(t=this.head.col,s=this.anchor.col);const i=s-t;return this.anchor_el.style.left=t*e+"px",this.anchor_el.style.width=i*e+"px",this.middle_el.style="",this.head_el.style="",this.ide.active_row_index=this.head.line,void this.ide.caret_manager.setColumn(this.head.col)}let i;this.anchor.line<this.head.line?(this.anchor_el.style.width=s-this.anchor.col*e+"px",this.anchor_el.style.left=this.anchor.col*e+"px",this.head_el.style.left="0",this.head_el.style.width=this.head.col*e+"px",i=this.anchor.line):(this.anchor_el.style.width=this.anchor.col*e+"px",this.anchor_el.style.left="0",this.head_el.style.left=this.head.col*e+"px",this.head_el.style.width=s-this.head.col*e+"px",i=this.head.line);const n=Math.abs(this.head.line-this.anchor.line)-1;0!==n?(this.middle_el.style.left="0",this.middle_el.style.top=(i+1)*t+"px",this.middle_el.style.width=s+"px",this.middle_el.style.height=n*t+"px"):this.middle_el.style="",this.head_el.style.top=this.head.line*t+"px",this.head_el.style.height=t+"px"}isOneRowSelected(){return this.single_selected_row>=0}}class A{static countLeadingWhitespaces(e){let t=0;for(;t<e.length&&/\s/.test(e[t]);)t++;return t}static countTrailingWhitespaces(e){let t=e.length-1;for(;t>=0&&/\s/.test(e[t]);)t--;return e.length-1-t}static isWhitespace(e){for(let t=0;t<e.length;t++)switch(e[t]){case" ":case"\t":case"\n":case"\r":break;default:return!1}return!0}}(c=n||(n={})).IDENTIFIER="identifier",c.LITERAL="literal",c.CALL="call",c.BREAK_STATEMENT="breakStatement",c.CONTINUE_STATEMENT="continueStatement",c.DECLARATION_STATEMENT="declarationStatement",c.ASSIGNMENT="assignmentExpression",c.FUNCTION_DEFINITION="functionDefinition",c.RETURN_STATEMENT="returnStatement",c.FOR_STATEMENT="forStatement",c.WHILE_STATEMENT="whileStatement",c.THEN_STATEMENT="thenStatement",c.IF_STATEMENT="ifStatement",c.ELSE_STATEMENT="elseStatement",c.ELSE_IF_STATEMENT="elseIfStatement",c.SWITCH_STATEMENT="switchStatement",c.SWITCH_CASE_STATEMENT="switchCaseStatement",c.BINARY_EXPRESSION="binaryExpression",c.UNARY_EXPRESSION="unaryExpression",c.BLOCK_STATEMENT="blockStatement",c.TERNARY_EXPRESSION="ternaryExpression",c.PROPERTY_ACCESS="propertyAccess",c.POSTFIX_OPERATION="postfixOperation",(h=r||(r={})).string="string",h.number="number",h.boolean="boolean",h.queue="Queue",h.set="Set",h.array="array",h.function_signature="function",h.unset="";class L{static isIdentifier(e){return e.type===n.IDENTIFIER}static isPropertyAccess(e){return e.type===n.PROPERTY_ACCESS}static isLValue(e){return e.type===n.PROPERTY_ACCESS||e.type===n.IDENTIFIER}static isExpression(e){switch(e.type){case n.BINARY_EXPRESSION:case n.ASSIGNMENT:case n.TERNARY_EXPRESSION:case n.UNARY_EXPRESSION:case n.LITERAL:return!0;default:return!1}}}class M{constructor(){this.node_index=0}getBinaryExpression(e,t,s){return{op:e,expression_left:t,expression_right:s,type:n.BINARY_EXPRESSION,next_node:null,debug_id:this.getDebugId(),start_index:t.start_index,end_index:s.end_index}}getUnaryExpression(e,t,s,i){return{op:e,expression:t,type:n.UNARY_EXPRESSION,next_node:null,debug_id:this.getDebugId(),start_index:s,end_index:i}}getTernaryExpression(e,t,s){return{condition:e,true_statement:t,false_statement:s,type:n.TERNARY_EXPRESSION,next_node:null,debug_id:this.getDebugId(),start_index:e.start_index,end_index:e.end_index}}getLiteralNode(e,t,s,i){return{value:e,valueType:t,type:n.LITERAL,next_node:null,debug_id:this.getDebugId(),start_index:s,end_index:i}}getIdentifierNode(e){return{name:e.lexeme,type:n.IDENTIFIER,debug_id:this.getDebugId(),start_index:e.start,end_index:e.end,next_node:null}}getCallNode(e,t){return{type:n.CALL,identifier:e,debug_id:this.getDebugId(),start_index:e.start_index,end_index:e.end_index,args:t,next_node:null}}getBreakStatement(e){return{type:n.BREAK_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:e.start,end_index:e.end}}getContinueStatement(e){return{type:n.CONTINUE_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:e.start,end_index:e.end}}getReturnStatement(e){return{type:n.RETURN_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:e.start,end_index:e.end}}getDeclarationStatement(e,t,s,i,r){return{types:s,type:n.DECLARATION_STATEMENT,lvalue:e,rvalue:t,next_node:null,debug_id:this.getDebugId(),start_index:i,end_index:r}}getAssignmentExpression(e,t,s){return{type:n.ASSIGNMENT,lvalue:t,operator:e,rvalue:s,next_node:null,debug_id:this.getDebugId(),start_index:t.start_index,end_index:s.end_index}}getFunctionDefinition(e,t,s,i){return{identifier_name:e,params:t,type:n.FUNCTION_DEFINITION,next_node:null,debug_id:this.getDebugId(),start_index:s,end_index:i}}getForStatement(e,t,s,i,r){return{statement_1:e,statement_2:t,statement_3:s,type:n.FOR_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:i,end_index:r}}getWhileStatement(e,t,s){return{expression_inside:e,type:n.WHILE_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:t,end_index:s}}getIfStatement(e,t,s){return{expression_inside:e,next_node:null,type:n.IF_STATEMENT,debug_id:this.getDebugId(),start_index:t,end_index:s}}getElseIfStatement(e,t,s){return{expression_inside:e,next_node:null,type:n.ELSE_IF_STATEMENT,debug_id:this.getDebugId(),start_index:t,end_index:s}}getElseStatement(e,t){return{type:n.ELSE_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:e,end_index:t}}getThenStatement(e,t){return{type:n.THEN_STATEMENT,next_node:null,debug_id:this.getDebugId(),start_index:e,end_index:t}}getSwitchStatement(e,t,s){return{expression_inside:e,next_node:null,type:n.SWITCH_STATEMENT,debug_id:this.getDebugId(),start_index:t,end_index:s}}getSwitchCaseStatement(e,t,s){return{expression_inside:e,next_node:null,type:n.SWITCH_CASE_STATEMENT,debug_id:this.getDebugId(),start_index:t,end_index:s}}getPropertyAccessExpression(e,t){return{parent_node:e,child_node:t,type:n.PROPERTY_ACCESS,next_node:null,debug_id:this.getDebugId(),start_index:e.start_index,end_index:t.start_index}}getPostfixOperation(e,t){return{operator:e,identifier:t,type:n.POSTFIX_OPERATION,next_node:null,debug_id:this.getDebugId(),start_index:t.start_index,end_index:e.end}}getDebugId(){return++this.node_index}}class k{constructor(){this.curr=null,this._root=null}get root(){return this._root}addStatement(e){null===this._root?(this._root=e,this.curr=e):(this.curr.next_node=e,this.curr=e)}}!function(e){e.Reset="[0m",e.Bright="[1m",e.Dim="[2m",e.Underscore="[4m",e.Blink="[5m",e.Reverse="[7m",e.Hidden="[8m",e.FgBlack="[30m",e.FgRed="[31m",e.FgGreen="[32m",e.FgYellow="[33m",e.FgBlue="[34m",e.FgMagenta="[35m",e.FgCyan="[36m",e.FgWhite="[37m",e.FgGray="[90m",e.BgBlack="[40m",e.BgRed="[41m",e.BgGreen="[42m",e.BgYellow="[43m",e.BgBlue="[44m",e.BgMagenta="[45m",e.BgCyan="[46m",e.BgWhite="[47m",e.BgGray="[100m"}(o||(o={}));class O{static formatAstJSON(e){function t(e){return null!=e&&"function"==typeof e[Symbol.iterator]}return JSON.stringify(function e(s){const i={type:O.formatNodeType(s.type)},n=Object.entries(s);for(const[s,r]of n)if("type"!==s&&"next_node"!==s)if(r&&"object"==typeof r)if("type"in r)i[s]=e(r);else if("lexeme"in r)i[s]=r.lexeme;else if(t(r)){i[s]=[];for(const t of r)t&&"object"==typeof t&&"type"in t?i[s].push(e(t)):i[s].push(t)}else i[s]="[unknown object]";else i[s]=r;return s.next_node&&(i.next_node=e(s.next_node)),i}(e))}static formatAst(e,t=0){const s=[];function i(e){return null!=e&&"function"==typeof e[Symbol.iterator]}return function e(t,n,r=""){"  ".repeat(n);const a=r?`${r}└──`:"";0===n&&s.push(`${a}[${o.FgGreen}${O.formatNodeType(t.type)}${o.Reset}]`);const h=Object.entries(t);for(const[t,a]of h){if("type"===t||"next_node"===t)continue;const h=`${o.FgBlue}${t}${o.Reset}`,c=r+"  ";if(a&&"object"==typeof a)if("type"in a)s.push(`${c}├── ${h}: [${o.FgMagenta}${O.formatNodeType(a.type)}${o.Reset}]`),e(a,n+1,c+"│ ");else if("lexeme"in a)s.push(`${c}├── ${h}: ${a.lexeme}`);else if(i(a)){s.push(`${c}├── ${h}: [`);for(const e of a)if(e&&"object"==typeof e&&"type"in e){s.push(`${c}│   ├── [${o.FgMagenta}${O.formatNodeType(e.type)}${o.Reset}]`);const t=O.formatAst(e,n+2);for(const e of t.split("\n"))s.push(`${c}│   │ ${e}`)}else s.push(`${c}│   ├── ${JSON.stringify(e)}`);s.push(`${c}│   ]`)}else s.push(`${c}├── ${h}: [unknown object]`);else s.push(`${c}├── ${h}: ${a}`)}t.next_node&&(s.push(`${r}${"=".repeat(40)} next_node ${"=".repeat(40)}`),e(t.next_node,n,r))}(e,t),s.join("\n")}static formatNodeType(e){switch(e){case n.IDENTIFIER:return"Identifier";case n.LITERAL:return"Literal";case n.CALL:return"Call";case n.BREAK_STATEMENT:return"Break Statement";case n.CONTINUE_STATEMENT:return"Continue Statement";case n.DECLARATION_STATEMENT:return"Declaration Statement";case n.ASSIGNMENT:return"Assignment Expression";case n.FUNCTION_DEFINITION:return"Function Definition";case n.RETURN_STATEMENT:return"Return Statement";case n.FOR_STATEMENT:return"For Statement";case n.WHILE_STATEMENT:return"While Statement";case n.THEN_STATEMENT:return"Then Statement";case n.IF_STATEMENT:return"If Statement";case n.ELSE_STATEMENT:return"Else Statement";case n.ELSE_IF_STATEMENT:return"Else If Statement";case n.SWITCH_STATEMENT:return"Switch Statement";case n.SWITCH_CASE_STATEMENT:return"Switch Case Statement";case n.BINARY_EXPRESSION:return"Binary Expression";case n.UNARY_EXPRESSION:return"Unary Expression";case n.BLOCK_STATEMENT:return"Block Statement";case n.TERNARY_EXPRESSION:return"Ternary Expression";case n.PROPERTY_ACCESS:return"Property Access";case n.POSTFIX_OPERATION:return"Postfix Operation";default:return"Unknown YASLNode Type ("+n+")"}}}function D(e){switch(e){case a.PLUS:case a.MINUS:case a.MULTIPLY:case a.DIVIDE:case a.MODULO:case a.POWER:case a.PLUS_ASSIGN:case a.MINUS_ASSIGN:case a.MULTIPLY_ASSIGN:case a.DIVIDE_ASSIGN:case a.MOD_ASSIGN:case a.POW_ASSIGN:case a.EQUAL_EQUAL:case a.NOT_EQUAL:case a.LESS_THAN:case a.GREATER_THAN:case a.LESS_THAN_EQUAL_TO:case a.GREATER_THAN_EQUAL_TO:case a.AND:case a.OR:case a.NOT:case a.BIT_AND:case a.BIT_OR:case a.BIT_NOT:case a.BIT_XOR:case a.BIT_SHIFT_LEFT:case a.BIT_SHIFT_RIGHT:case a.INCREMENT:case a.DECREMENT:case a.NEGATE:case a.ASSIGN:case a.INLINE_ASSIGN:return"operator";case a.NUMBER:return"number";case a.STRING:return"string";case a.WHITESPACE:return"whitespace";case a.COMMENT:return"comment";case a.NULL:case a.TRUE:case a.FALSE:case a.LET:case a.IF:case a.ELSE:case a.SWITCH:case a.CASE:case a.DEFAULT:case a.FOR:case a.WHILE:case a.THEN:case a.DO:case a.BREAK:case a.CONTINUE:case a.IN:case a.INSTANCEOF:case a.FUNCTION:case a.RETURN:return"keyword";case a.LPAREN:case a.RPAREN:case a.LBRACKET:case a.RBRACKET:case a.LBRACE:case a.RBRACE:case a.COMMA:case a.DOT:case a.COLON:case a.STATEMENT_END:return"symbol";case a.IDENTIFIER:return"identifier";case a.EOF:return"eof";case a.ERROR:return"error";default:throw"Not implemented token type stringification"+e}}(d=a||(a={})).ERROR="error",d.COMMENT="comment",d.WHITESPACE="whitespace",d.STATEMENT_END=";",d.EQUAL_EQUAL="==",d.NOT_EQUAL="!=",d.LESS_THAN="<",d.GREATER_THAN=">",d.LESS_THAN_EQUAL_TO="<=",d.GREATER_THAN_EQUAL_TO=">=",d.ASSIGN="=",d.INLINE_ASSIGN=":=",d.PLUS_ASSIGN="+=",d.MINUS_ASSIGN="-=",d.MULTIPLY_ASSIGN="*=",d.DIVIDE_ASSIGN="/=",d.MOD_ASSIGN="%=",d.POW_ASSIGN="**=",d.PLUS="+",d.MINUS="-",d.MULTIPLY="*",d.DIVIDE="/",d.MODULO="%",d.POWER="**",d.AND="and",d.OR="or",d.NOT="not",d.BIT_AND="&",d.BIT_OR="|",d.BIT_NOT="~",d.BIT_XOR="^",d.BIT_SHIFT_LEFT="<<",d.BIT_SHIFT_RIGHT=">>",d.INCREMENT="++",d.DECREMENT="--",d.NEGATE="!",d.NUMBER="number",d.STRING="string",d.NULL="null",d.LET="let",d.IF="if",d.ELSE="else",d.SWITCH="switch",d.CASE="case",d.DEFAULT="default",d.FOR="for",d.WHILE="while",d.THEN="then",d.DO="do",d.BREAK="break",d.CONTINUE="continue",d.IN="in",d.INSTANCEOF="instanceof",d.FUNCTION="fn",d.RETURN="return",d.TRUE="true",d.FALSE="false",d.LPAREN="(",d.RPAREN=")",d.LBRACKET="[",d.RBRACKET="]",d.LBRACE="{",d.RBRACE="}",d.COMMA=",",d.DOT=".",d.COLON=":",d.IDENTIFIER="identifier",d.EOF="\0";const P=Object.freeze(new Map([["let",a.LET],["switch",a.SWITCH],["if",a.IF],["else",a.ELSE],["case",a.CASE],["default",a.DEFAULT],["for",a.FOR],["while",a.WHILE],["do",a.DO],["break",a.BREAK],["continue",a.CONTINUE],["in",a.IN],["instanceof",a.INSTANCEOF],["fn",a.FUNCTION],["return",a.RETURN],["true",a.TRUE],["false",a.FALSE],["in",a.IN],["and",a.AND],["or",a.OR],["not",a.NOT],["null",a.NULL],["then",a.THEN]]));function F(e){switch(e.lexeme){case"string":case"int":case"Set":case"Queue":case"Function":return e.lexeme;default:return null}}function B(e){if(!e)return!1;switch(e.type){case a.LPAREN:case a.DOT:case a.MODULO:case a.MULTIPLY:case a.DIVIDE:case a.PLUS:case a.MINUS:case a.POWER:case a.INLINE_ASSIGN:case a.DECREMENT:case a.INCREMENT:return!0;default:return!1}}function U(e){switch(e){case a.DOT:return[100,101];case a.LPAREN:return[90,91];case a.AND:case a.OR:return[80,81];case a.INCREMENT:case a.DECREMENT:return[80,-1];case a.POWER:return[30,29];case a.MULTIPLY:case a.MODULO:case a.DIVIDE:return[20,21];case a.MINUS:case a.PLUS:return[10,11];case a.INLINE_ASSIGN:return[1,0];default:return null}}function H(e){switch(e){case a.INCREMENT:case a.DECREMENT:return!0;default:return!1}}function z(e){switch(e){case a.STATEMENT_END:case a.MODULO:case a.MULTIPLY:case a.DIVIDE:case a.PLUS:case a.MINUS:case a.POWER:return!0;default:return!1}}function $(e,t){let s=function(e,t){let s=0,i=t.length-1;for(;s<=i;){const n=s+i>>>1;if(t[n]===e)return n;t[n]<e?s=n+1:i=n-1}return-1}(e,t);return[s,e-t[s]]}class W{constructor(e,t){this.tokens=e,this.line_map=t,this.next_index=0,this.parenthesis_count=0,this.program=new k,this.node_factory=new M,this.errors=Array()}getProgram(){for(;!this.isEOF();)this.parseStatement();return this.program}parseStatement(){const e=this.peek();switch(e.type){case a.STATEMENT_END:this.consume();break;case a.LET:this.parseDeclaration();break;case a.IDENTIFIER:const t=this.consumeExpression();if(!t){this.errorToken("Invalid statement",e);break}const s=this.peek();if(s.type===a.INLINE_ASSIGN){this.errorToken("Inline assignment used as normal assignment, use '=' for assignments in a statement");break}if(function(e){switch(e){case a.ASSIGN:case a.MULTIPLY_ASSIGN:case a.DIVIDE_ASSIGN:case a.MOD_ASSIGN:case a.POW_ASSIGN:case a.PLUS_ASSIGN:case a.MINUS_ASSIGN:return!0;default:return!1}}(s.type)){if(this.consume(),!L.isLValue(t)){this.errorToken("Invalid LValue");break}const e=this.consumeExpression();if(!e){this.errorToken("Invalid RValue");break}this.program.addStatement(this.node_factory.getAssignmentExpression(s,t,e))}else this.program.addStatement(t);break;default:this.parseExpression()}}synchronize(){for(;!this.isEOF()&&this.peek().type!==a.STATEMENT_END;)this.consume()}errorToken(e,t=null){const s=null==t?this.tokens[this.next_index-1]:t,[i,n]=$(s.start,this.line_map),[r,o]=$(s.end,this.line_map);this.errors.push({message:e,token:s,highlight:"",start_col:n,end_col:o,start_line:i,end_line:r}),this.synchronize()}consume(){const e=this.tokens[this.next_index];return this.next_index++,e}match(e){return this.peek().type===e}peek(){return this.next_index>=this.tokens.length?this.tokens[this.tokens.length-1]:this.tokens[this.next_index]}expect(e,t){return this.peek().type===e?this.consume():(this.errorToken(t),null)}isEOF(){return this.next_index>=this.tokens.length}parseExpression(){const e=this.peek();let t=null;switch(e.type){case a.STATEMENT_END:case a.EOF:this.consume();break;case a.NUMBER:case a.LPAREN:case a.IDENTIFIER:t=this.consumeExpression();break;default:this.errorToken("Invalid token",e)}t&&this.program.addStatement(t)}parseDeclaration(){this.expect(a.LET,"Assignment requires let");const e=this.expect(a.IDENTIFIER,"Expected an identifier");if(!e)return;let t=null;if(this.match(a.COLON)&&(this.consume(),this.peek().type===a.IDENTIFIER&&(t=this.consumeValueType())),this.match(a.STATEMENT_END))return void this.program.addStatement(this.node_factory.getDeclarationStatement(e.lexeme,null,t,e.start,e.end));this.expect(a.ASSIGN,"Invalid token");const s=this.consumeExpression(),i=this.node_factory.getDeclarationStatement(e.lexeme,s,t,e.start,s?s.end_index:e.end);this.program.addStatement(i)}consumeValueType(){let e=new Set;for(;;){const t=this.peek(),s=F(t);if(null===s){if(t.type!==a.BIT_OR)break}else e.add(s);this.consume()}return e}nud(e){switch(e.type){case a.MINUS:case a.NOT:{const t=this.consumeExpression(0);if(t&&L.isExpression(t))return this.node_factory.getUnaryExpression(e.type,t,e.start,t.end_index);break}case a.NUMBER:return this.node_factory.getLiteralNode(e.literal,r.number,e.start,e.end);case a.IDENTIFIER:return this.node_factory.getIdentifierNode(e);case a.LPAREN:const t=this.consumeExpression();return this.expect(a.RPAREN,"Expected ) but found "+this.peek().lexeme),t;case a.STRING:return this.node_factory.getLiteralNode(e.literal,r.string,e.start,e.end);default:this.errorToken(`Unexpected token in nud: ${e.lexeme}`,e)}return null}led(e,t,s){const[,i]=s;if(e.type===a.LPAREN){if(!L.isLValue(t))return this.errorToken("Invalid function call. Only a valid LValue can have a function call"),null;const e=[];if(this.parenthesis_count++,this.match(a.RPAREN))this.consume();else{let t=null;for(;!this.isEOF();){const s=this.consumeExpression(0);if(s&&e.push(s),t=this.peek(),t.type!==a.COMMA){if(t.type===a.RPAREN){this.consume(),this.parenthesis_count--;break}this.errorToken("Expected ) at the end of function call",t);break}this.consume()}}return this.node_factory.getCallNode(t,e)}const r=this.consumeExpression(i);return r?e.type===a.INLINE_ASSIGN?L.isLValue(t)?this.node_factory.getAssignmentExpression(e,t,r):(this.errorToken(`${O.formatAstJSON(t)} is an invalid LValue`,e),null):e.type===a.DOT?r.type===n.IDENTIFIER&&L.isLValue(t)?this.node_factory.getPropertyAccessExpression(t,r):(this.errorToken("The right side of property access must be a valid identifier but was "+O.formatNodeType(t.type)),null):L.isExpression(t)&&L.isExpression(r)?this.node_factory.getBinaryExpression(e.type,t,r):(this.errorToken("Invalid expression",e),null):null}consumeExpression(e=0){const t=this.consume();let s=this.nud(t);for(;!this.isEOF();){if(!s)return null;const t=this.peek();if(!B(t))return s;const i=U(t.type);if(!i)break;const[n]=i;if(n<e)break;if(this.consume(),H(t.type))return z(this.peek().type)||this.errorToken("Postfix operators can only be followed by an expression terminator"),L.isLValue(s)?this.node_factory.getPostfixOperation(t,s):(this.errorToken("Postfix operator can only be applied to a LValue"),null);s=this.led(t,s,i)}return s}}class G{constructor(e,t=!1){this.text=e,this.tokenise_whitespaces=t,this.LineMap=[],this.tokens_list=Array(),this.curr_line=0,this.curr_col=0,this.curr_read_index=0,this.start_read_index=0,this.next_read_index=0,this.whitespace_regex=/\s/,this.is_analysis_complete=!1}getTokens(){for(;!this.isEOF();)this.start_read_index=this.next_read_index,this.scanToken();return this.is_analysis_complete||(this.start_read_index=this.next_read_index,this.is_analysis_complete=!0,this.addToken(a.EOF)),this.tokens_list}scanToken(){const e=this.consume();if(e.match(/[a-zA-Z_]/))this.consume_identifier(e);else if(e.match(/[0-9]/))this.consume_number(e);else switch(e){case";":case"\n":this.addToken(a.STATEMENT_END,null),this.LineMap.push(this.curr_read_index);break;case"(":case")":case"[":case"]":case"{":case"}":case".":case",":case"&":case"|":case"^":case"~":this.addToken(e);break;case":":"="==this.peek()?(this.consume(),this.addToken(a.INLINE_ASSIGN)):this.addToken(a.COLON);break;case"=":"="==this.peek()?(this.consume(),this.addToken(a.EQUAL_EQUAL)):this.addToken(a.ASSIGN);break;case"<":"="==this.peek()?(this.consume(),this.addToken(a.LESS_THAN_EQUAL_TO)):"<"==this.peek()?(this.consume(),this.addToken(a.BIT_SHIFT_LEFT)):this.addToken(a.LESS_THAN);break;case">":"="==this.peek()?(this.consume(),this.addToken(a.GREATER_THAN_EQUAL_TO)):">"==this.peek()?(this.consume(),this.addToken(a.BIT_SHIFT_RIGHT)):this.addToken(a.GREATER_THAN);break;case"!":"="==this.peek()?(this.consume(),this.addToken(a.NOT_EQUAL)):this.addToken(a.NEGATE);break;case"+":"="==this.peek()?(this.consume(),this.addToken(a.PLUS_ASSIGN)):"+"==this.peek()?(this.consume(),this.addToken(a.INCREMENT)):this.addToken(a.PLUS);break;case"-":"="==this.peek()?(this.consume(),this.addToken(a.MINUS_ASSIGN)):"-"==this.peek()?(this.consume(),this.addToken(a.DECREMENT)):this.addToken(a.MINUS);break;case"*":"="==this.peek()?(this.consume(),this.addToken(a.MULTIPLY_ASSIGN)):"*"==this.peek()?(this.consume(),"="==this.peek()?(this.consume(),this.addToken(a.POW_ASSIGN)):this.addToken(a.POWER)):this.addToken(a.MULTIPLY);break;case"%":"="==this.peek()?(this.consume(),this.addToken(a.MOD_ASSIGN)):this.addToken(a.MODULO);break;case"/":switch(this.peek()){case"/":for(this.consume();!this.isEOF()&&"\n"!==this.peek();)this.consume();this.addToken(a.COMMENT);break;case"=":this.consume(),this.addToken(a.DIVIDE_ASSIGN);break;default:this.addToken(a.DIVIDE)}break;case'"':case"'":this.consume_string(e);break;case" ":case"\t":this.tokenise_whitespaces&&this.addToken(a.WHITESPACE);break;default:this.reportError("Invalid token",e)}}isEOF(){return this.next_read_index>=this.text.length}getLineMap(){return this.LineMap}peek(){return this.isEOF()?"\0":this.text[this.next_read_index]}reportError(e,t=null){const s={column:this.curr_col,line:this.curr_line,message:e,source:t||this.text.slice(this.start_read_index,this.next_read_index)};this.addToken(a.ERROR,s)}consume(){if(this.isEOF())return"\0";const e=this.text[this.next_read_index];return"\n"===e&&(this.curr_line++,this.curr_col=0),this.next_read_index++,this.curr_read_index++,this.curr_col++,e}addToken(e,t=null){const s=this.text.slice(this.start_read_index,this.next_read_index);this.tokens_list.push({type:e,lexeme:s,literal:t,start:this.start_read_index,end:this.next_read_index})}consume_identifier(e){let t=e;for(;!this.isEOF();){const e=this.peek();if(!(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"==e))break;t+=e,this.consume()}if(P.has(t))switch(t){case"true":this.addToken(a.TRUE,!0);break;case"false":this.addToken(a.FALSE,!1);break;case"null":this.addToken(a.NULL,null);break;default:this.addToken(t,t)}else this.addToken(a.IDENTIFIER,t)}consume_number(e){let t=!1,s=e,i="",n=!1;for(;!this.isEOF();){const e=this.peek();if(/[0-9]/.test(e))this.consume(),s+=e,i=e;else if("_"===e)"_"!==i&&"."!==i||(n=!0),this.consume(),i=e;else{if("."!==e||t)break;"_"!==i&&"_"!==this.peek()||(n=!0),this.consume(),t=!0,s+=".",i=e}}if("_"===i&&(n=!0),n)this.reportError("Invalid underscore placement in number");else{const e=t?parseFloat(s):parseInt(s);!Number.isFinite(e)||Number.isNaN(e)?this.reportError("Numeric overflow",s):this.addToken(a.NUMBER,e)}}consume_string(e){let t="";for(;!this.isEOF();){const s=this.consume();if(s===e)break;if("\n"==s)return void this.reportError("Invalid newline in single line string",t);if("\0"==s)return void this.reportError("Reached end of file after",t);if("\\"===s)switch(this.consume()){case'"':t+='"';break;case"'":t+="'";break;case"n":t+="\n";break;case"t":t+="\t";break;case"r":t+="\r";break;case"\\":t+="\\"}else t+=s}this.addToken(a.STRING,t)}}const q=new G('//Test for text highlight\nlet x = 1000;\nlet y = "hello world"\nprint(x,y)\n\nif(x > 100){\n    print("x above hundred")\n}\nswitch(y){\n    case 1:\n        while((let x:=2)){\n            someFunction(x)\n            x++;\n        }\n        break\n    default:\n        break\n}\n            ',!0);var Y,j,X,V,K;function Q(e,t,s){return e>s.x&&e<s.x+s.width&&t>s.y&&t<s.y+s.height}console.log(q.getTokens()),(X=Y||(Y={}))[X.AlreadyDefined=0]="AlreadyDefined",X[X.Success=1]="Success",X[X.NotDefined=2]="NotDefined",function(e){e[e.Node=0]="Node",e[e.Native=1]="Native",e[e.Environment=2]="Environment"}(j||(j={}));class Z{constructor(e,t){this.ide=e,this.row_el=t,this.insertion_col=0,this._raw="",this._tokens=[],this.row_el.classList.add("yasl-editor-row")}get tokens(){return this._tokens}get raw(){return this._raw}set tokens(e){this._tokens=e}set raw(e){this._raw=e;const t=new G(this._raw+"\n",!0);this.tokens=t.getTokens()}render(){const e=this.raw;let t="";if(this.tokens.length>0)for(const s of this.tokens){if(s.type===a.EOF)break;const i=e.slice(s.start,s.end);t+=`<span class='${D(s.type)}'>${i}</span>`}else t=e;this.row_el.innerHTML=t,this._tokens=this.tokens;const s=A.countLeadingWhitespaces(this.raw);if(s===this.raw.length)return;const i=s/this.ide.tab_width,n=this.ide.caret_manager.char_width*this.ide.tab_width;let r="";console.log(this.raw,i);for(let e=1;e<i;e++){const t=e*n,s=t+2;r+=`, transparent ${t}px ,var(--yasl-ide-indent-color) ${s}px, transparent ${s}px`}this.row_el.style.background=`linear-gradient(90deg ${r} )`}goToStart(){const e=A.countLeadingWhitespaces(this.raw);this.ide.caret_manager.setColumn(e)}goToEnd(){const e=A.countTrailingWhitespaces(this.raw);this.ide.caret_manager.setColumn(this.raw.length-e)}appendStr(e){this.insertion_col===this.raw.length?this.raw+=e:this.insertion_col<this.raw.length&&(this.raw=this.raw.slice(0,this.insertion_col)+e+this.raw.slice(this.insertion_col)),this.render()}clear(){this.raw=""}getRowHeight(){return this.row_el.offsetHeight}activate(){this.row_el.classList.add("active")}deactivate(){this.row_el.classList.remove("active")}setHeight(e){this.row_el.style.height=e+"px"}getDomNode(){return this.row_el}setColumn(e){this.insertion_col=e}backspaceChar(){0!==this.insertion_col&&(this.raw.slice(0,this.insertion_col).match(/^\s*$/)?(this.raw=this.raw.slice(this.insertion_col,this.raw.length),this.ide.caret_manager.setColumn(0)):(this.raw=this.raw.slice(0,this.insertion_col-1)+this.raw.slice(this.insertion_col,this.raw.length),this.ide.caret_manager.moveCol(-1)),console.log("backspace",this.raw),this.render())}removeStr(e,t=-1){if(0!==e||t!==this.raw.length&&-1!==t||(this.raw=""),e>=0&&t>=0&&e!==t){const s=this.raw.slice(0,e),i=this.raw.slice(t,this.raw.length);this.raw=s+i}else if(e>0&&t<0){const s=this.raw.length+t+1,i=this.raw.slice(0,e),n=this.raw.slice(s,this.raw.length);this.raw=i+n}this.render()}deleteChar(){this._raw.length>0&&this.insertion_col<this.raw.length&&(this.raw=this.raw.slice(0,this.insertion_col)+this.raw.slice(this.insertion_col+1,this.raw.length),this.render())}selectWord(e,t){this.row_el.getBoundingClientRect();for(const s of this.row_el.children){const i=s.getBoundingClientRect();if(Q(e,t,i)){const e=i.x,t=i.x+i.width,s=this.ide.getColumnFromPoint(e),n=this.ide.getColumnFromPoint(t);this.ide.selection.setAnchor(s,this.ide.active_row_index),this.ide.selection.moveHead(n,this.ide.active_row_index);break}}}selectRow(){}setText(e){this.raw=e,this.render()}}class J{constructor(e){this.row_wrapper_rect=new DOMRect,this.tab_width=4,this.editor_rows=[],this.gutter_el=document.createElement("div"),this.editor_el=document.createElement("div"),this.selection=new R(this.editor_el,this),this.row_wrapper=document.createElement("div"),this.key_manager=new I(this.editor_el,e=>this.bindKeyboardEvents(e)),this.is_mouse_down=!1,this.row_height=10,this.char_width=10,this._active_row_index=0,this.createDomStructure(e),this.bindMouseEvents(),this.bindResizeEvents(),this.bindBlurEvent(),this.initialize().then(()=>{this.editor_el.classList.add("ready")}),this.caret_manager=new b(this.editor_el,this.editor_rows[this.active_row_index])}createDomStructure(e){const t=document.createElement("div");t.append(this.gutter_el,this.editor_el),t.classList.add("yasl-editor-wrapper"),this.editor_el.tabIndex=1,this.editor_el.classList.add("yasl-editor"),this.gutter_el.classList.add("yasl-editor-gutter"),this.row_wrapper.classList.add("yasl-editor-rows-wrapper");const s=document.createElement("div");s.classList.add("yasl-ide-loader"),s.innerText="loading",this.editor_el.append(s,this.row_wrapper),e.append(t)}set active_row_index(e){if(null==e)return;const t=this.editor_rows[this.active_row_index],s=C.clamp(e,0,this.editor_rows.length-1),i=this.editor_rows[s];t.deactivate(),i.activate(),this.caret_manager.setRow(i),this._active_row_index=s}bindResizeEvents(){window.addEventListener("resize",()=>this.updateIdeRect()),new ResizeObserver(()=>{this.updateIdeRect()}).observe(this.row_wrapper)}bindBlurEvent(){this.editor_el.onblur=()=>{this.editor_rows[this.active_row_index]?.deactivate()}}async initialize(){await document.fonts.ready;const e=window.getComputedStyle(this.editor_el),t=`${e.fontSize} ${e.fontFamily}`;await document.fonts.load(t),await new Promise(requestAnimationFrame);const s=function(e){const t=document.createElement("span");t.textContent="MWXgyjq",t.style.visibility="hidden",t.style.position="absolute",t.style.whiteSpace="pre";const s=window.getComputedStyle(e);t.style.font=s.font,t.style.fontSize=s.fontSize,t.style.fontFamily=s.fontFamily,t.style.letterSpacing=s.letterSpacing,t.style.fontWeight=s.fontWeight,t.style.lineHeight=s.lineHeight,document.body.appendChild(t);const i=t.getBoundingClientRect();return document.body.removeChild(t),console.log("Calculating font metrics for",t.style.fontFamily),{width:i.width/7,height:i.height}}(this.editor_el),i=s.height;for(const e of this.editor_rows)e.setHeight(i);this.caret_manager.setFontMetrics(s.width,s.height),this.row_height=i,this.char_width=s.width;const n=document.createElement("div"),r=new Z(this,n);r.setHeight(this.row_height),this.editor_rows.push(r),this.row_wrapper.appendChild(n),this.updateIdeRect(),this.pasteString('//Test for text highlight\nlet x = 1000;\nlet y = "hello world"\nprint(x,y)\n\nif(x > 100){\n    print("x above hundred")\n}\nswitch(y){\n    case 1:\n        while((let x:=2)){\n            someFunction(x)\n            x++;\n        }\n        break\n    default:\n        break\n}\n'),this.updateGutter(),this.editor_rows[this.active_row_index]?.deactivate()}get active_row_index(){return this._active_row_index}bindMouseEvents(){this.editor_el.onmousedown=e=>{switch(this.updateIdeRect(),e.detail){case 1:{const t=this.getRowFromPoint(e.clientY);this.active_row_index=t;const s=this.getColumnFromPoint(e.clientX);this.caret_manager.setColumn(s),this.selection.setAnchor(s,t),this.is_mouse_down=!0,console.log(this.active_row_index);break}case 2:this.editor_rows[this.active_row_index]?.selectWord(e.clientX,e.clientY);break;default:{const t=this.getColumnFromPoint(e.clientX);this.caret_manager.setColumn(t),this.selection.selectRow(this.active_row_index);break}}this.editor_el.focus(),e.preventDefault()},window.addEventListener("mouseup",()=>{this.is_mouse_down=!1}),window.addEventListener("mousemove",e=>{if(!this.is_mouse_down)return;const t=this.getColumnFromPoint(e.clientX),s=this.getRowFromPoint(e.clientY);this.selection.moveHead(t,s),this.active_row_index=s,this.caret_manager.setColumn(t)})}updateGutter(){let e=this.gutter_el.childElementCount;for(;e<this.editor_rows.length;){const t=document.createElement("div");e++,t.innerText=e.toString(),this.gutter_el.append(t)}for(;e>this.editor_rows.length;)this.gutter_el.lastElementChild?.remove(),e--}updateIdeRect(){if(!this.editor_el)return;const e=this.row_wrapper.getBoundingClientRect();this.row_wrapper_rect.height=e.height,this.row_wrapper_rect.width=e.width,this.row_wrapper_rect.x=e.x,this.row_wrapper_rect.y=e.y}insertRowAfter(e){const t=this.editor_rows[e].getDomNode(),s=document.createElement("div"),i=new Z(this,s);i.setHeight(this.row_height),this.editor_rows.splice(e+1,0,i),t.insertAdjacentElement("afterend",s),this.updateIdeRect(),this.updateGutter()}insertRowAfterCurrent(){this.insertRowAfter(this.active_row_index)}moveUp(){this.active_row_index--}moveDown(){this.active_row_index++}getMaxColumn(e){return e>=this.editor_rows.length?0:this.editor_rows[e].raw.length}getTotalRowIndices(){return this.editor_rows.length-1}getColumnFromPoint(e){return C.clamp(Math.round((e-this.row_wrapper_rect.x)/this.char_width),0,this.getMaxColumn(this.active_row_index))}getRowFromPoint(e){return C.clamp(Math.round((e-this.row_wrapper_rect.y)/this.row_height),0,this.getTotalRowIndices())}pasteString(e){let t="",s=0;for(const i of e)"\n"!==i?t+=i:(s>=this.editor_rows.length&&(this.insertRowAfter(this.editor_rows.length-1),this.moveDown()),this.editor_rows[s].setText(t),t="",s++);t.length>0&&(this.insertRowAfterCurrent(),this.moveDown(),this.editor_rows[s].setText(t),t=""),this.editor_rows[this.active_row_index].goToEnd()}run(){let e="";for(let t=0;t<this.editor_rows.length;t++)e+=this.editor_rows[t].raw+"\n";const t=new G(e),s=new W(t.getTokens(),t.getLineMap());console.log(e),console.log(s.getProgram())}deleteSelection(){if(!this.selection.isSelected())return;const e=this.selection.getStart(),t=this.selection.getEnd(),s=e.line,i=e.col,n=t.line,r=t.col;if(s===n){const e=this.editor_rows[s];return e?.removeStr(i,r),this.selection.clear(),void this.caret_manager.setColumn(i)}const o=this.editor_rows[s],a=this.editor_rows[n];o.removeStr(i,-1),a.removeStr(0,r);let h=n-1;0===a.raw.length&&(a.getDomNode().remove(),h=n);for(let e=s+1;e<=h;e++)this.editor_rows[e]?.getDomNode().remove();this.active_row_index=s;const c=h-s;this.deleteRows(s+1,c),this.selection.clear()}deleteRow(e){this.deleteRows(e,1)}deleteRows(e,t){const s=e+t-1;for(let t=e;t<=s;t++){const e=this.editor_rows[t];e&&e.getDomNode().remove()}this.active_row_index>=e&&this.active_row_index<=s&&(this.active_row_index=Math.max(0,e-1),this.caret_manager.setColumn(-1)),this.editor_rows.splice(e,t),this.updateGutter()}moveCol(e){if(this.selection.isSelected()){const t=e<0?this.selection.getStart():this.selection.getEnd();this.active_row_index=t.line,this.caret_manager.setColumn(t.col)}else this.caret_manager.moveCol(e);this.selection.clear()}appendChar(e){const t=this.editor_rows[this.active_row_index];this.deleteSelection(),t.appendStr(e),this.caret_manager.moveCol(e.length)}deleteChar(e){if(this.selection.isSelected())return void this.deleteSelection();const t=this.editor_rows[this.active_row_index];switch(e){case-1:if(t.backspaceChar(),this.caret_manager.isAtStart()&&!this.isFirstRowActive()){const e=this.editor_rows[this.active_row_index-1];this.active_row_index-=1,this.caret_manager.setColumn(-1),e.appendStr(t.raw),this.deleteRow(this.active_row_index+1)}break;case 1:if(this.caret_manager.isAtEnd()&&!this.isLastRowActive()){const e=this.editor_rows[this.active_row_index+1];t.appendStr(e.raw),this.deleteRow(this.active_row_index+1)}t.deleteChar();break;default:alert("Invalid direction for delete char in ide")}}isFirstRowActive(){return 0===this._active_row_index}bindKeyboardEvents(e){console.log(this);const t=this.editor_rows[this.active_row_index];switch(e){case i.Backspace:this.deleteChar(-1);break;case i.Delete:this.deleteChar(1);break;case i.Home:t.goToStart();break;case i.End:t.goToEnd();break;case i.Enter:this.insertRowAfterCurrent(),this.moveDown();break;case i.ARROW_LEFT:this.moveCol(-1);break;case i.ARROW_RIGHT:this.moveCol(1);break;case i.ARROW_DOWN:this.moveDown();break;case i.ARROW_UP:this.moveUp();break;case i.Tab:this.tab_width>0?t.appendStr(" ".repeat(this.tab_width)):t.appendStr("\t");break;case i.COPY:this.copyText();break;default:!function(e){return 1===e.length&&e.match(/[\p{L}\p{N}\p{P}\p{S}\p{Z}]/u)}(e)?console.log("unknown key handing over to IDE:",e):this.appendChar(e)}}isLastRowActive(){return this._active_row_index===this.editor_rows.length-1}copyText(){let e="";if(this.selection.isSelected()&&!this.selection.isOneRowSelected()){const t=this.selection.getStart(),s=this.selection.getEnd(),i=this.editor_rows[t.line];if(t.line===s.line)e=i.raw.slice(t.col,s.col);else{console.log(i.raw),e=i.raw.slice(t.col,i.raw.length);for(let i=t.line+1;i<s.line;i++){const t=this.editor_rows[i];e+="\n"+t.raw}const n=this.editor_rows[s.line];e+="\n"+n.raw.slice(0,s.col)}}else{const t=this.editor_rows[this.active_row_index];e=t.raw}const t=navigator.clipboard;t&&e.length>0&&t.writeText(e).then(()=>console.log("Copied\n",e))}}class ee{constructor(...e){if("string"==typeof e[0]){this.hex=e[0];const{r:t,g:s,b:i,a:n}=ee.hexToRgba(this.hex);this.r=t,this.g=s,this.b=i,this.a=n}else{const[t=0,s=0,i=0,n=1]=e;this.r=t,this.g=C.clamp(s,0,255),this.b=C.clamp(i,0,255),this.a=C.clamp(n,0,255),this.hex=ee.getHex(t,s,i,n)}}static hexToRgba(e){if(e=e.replace(/^#/,""),![3,4,6,8].includes(e.length))throw new Error("Invalid hex color code"+e+". Must be 3, 4, 6, or 8 digits. but was"+e);3!==e.length&&4!==e.length||(e=e.split("").map(e=>e+e).join(""));let t,s,i,n=1;return 6===e.length?(t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16)):(t=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),i=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16)/255),n=Math.round(100*n)/100,{r:t,g:s,b:i,a:n}}static getHex(e,t,s,i){return`#${e.toString(16).padStart(2,"0")}${t.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${i?Math.round(255*i).toString(16).padStart(2,"0"):""}`}toString(){return 1===this.a?`rgb(${this.r}, ${this.g}, ${this.b})`:`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a.toFixed(2)})`}}function te(e,t,s,i){return e===t?t:e+(t-e)*i(s)}class se{static linear(e){return e}static easeInSin(e){return 1-Math.cos(e*Math.PI/2)}static easeOutSin(e){return Math.sin(e*Math.PI/2)}static easeInOutSin(e){return(1-Math.cos(e*Math.PI))/2}static easeInCubic(e){return e**3}static easeOutCubic(e){return 1-(1-e)**3}static easeInOutCubic(e){return e<.5?4*e**3:1-(1-e)**3}static easeInQuad(e){return e*e}static easeOutQuad(e){return 1-(1-e)**2}static easeInOutQuad(e){return e<.5?2*e**2:1-(1-e)**2}}class ie{constructor(e,t,s){this.total_duration_ms=t,this.duration_passed_ms=0,this.easing=s,this.drawable=e}getId(){return this.drawable?this.constructor.name+this.drawable.id:this.constructor.name}}class ne extends ie{constructor(e,t,s,i=250,n=se.easeInSin){super(e,i,n),this.from=t,this.to=s,this.drawable.is_color_animating=!0}finalize(){this.setNormalizedTime(1),this.drawable.is_color_animating=!1,this.drawable.color=this.to,this.interrupt()}interrupt(){this.drawable.is_color_animating=!1}setNormalizedTime(e){const t=C.roundedClamp(te(this.from.r,this.to.r,e,this.easing),0,255),s=C.roundedClamp(te(this.from.g,this.to.g,e,this.easing),0,255),i=C.roundedClamp(te(this.from.b,this.to.b,e,this.easing),0,255),n=C.roundedClamp(te(this.from.a,this.to.a,e,this.easing),0,255);this.drawable.color=new ee(t,s,i,n)}}class re extends ie{constructor(e,t,s,i=250,n=se.easeInSin){super(null,i,n),this.callback=e,this.from=t,this.to=s}finalize(){this.setNormalizedTime(1)}interrupt(){}setNormalizedTime(e){this.callback(te(this.from,this.to,e,this.easing),1===e)}}class oe{constructor(){this.animations_map=new Map}add(e){const t=e.getId();this.animations_map.has(t)&&this.animations_map.get(t)?.interrupt(),this.animations_map.set(t,e)}step(e){for(const[t,s]of this.animations_map){if(s.duration_passed_ms+=e,s.duration_passed_ms>s.total_duration_ms){s.duration_passed_ms=s.total_duration_ms,s.finalize(),this.animations_map.delete(t);break}const i=s.duration_passed_ms/s.total_duration_ms;s.setNormalizedTime(i)}}}!function(e){e[e.LIGHT=0]="LIGHT",e[e.DARK=1]="DARK",e[e.AUTO=2]="AUTO"}(V||(V={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.SELECTED="selected",e.HOVER="hover",e.ON_BACKGROUND="on-background",e.ON_PRIMARY="on-primary",e.ON_SECONDARY="on-secondary",e.BORDER="border"}(K||(K={}));const ae=function(){const e="theme";let t=!1,s=!1,i=getComputedStyle(document.documentElement);function n(){i=getComputedStyle(document.documentElement)}return{setThemeType:r=>{switch(i=getComputedStyle(document.documentElement),t=!1,r){case V.LIGHT:document.documentElement.setAttribute(e,"light");break;case V.DARK:document.documentElement.setAttribute(e,"dark");break;case V.AUTO:!function(){if(window.matchMedia){const i=window.matchMedia("(prefers-color-scheme: dark)");if(t=!0,i.matches?document.documentElement.setAttribute(e,"dark"):document.documentElement.setAttribute(e,"light"),s)return;i.addEventListener("change",i=>{s=!0,t&&(n(),i.matches?document.documentElement.setAttribute(e,"dark"):document.documentElement.setAttribute(e,"light"))})}else document.documentElement.setAttribute(e,"light")}()}n()},getBgColor(e,t=K.DEFAULT){const s=`--${e}-bg-${t}-color`,n=i.getPropertyValue(s);return""===n&&console.error(s," is not defined."),new ee(n)},getFgColor(e,t=K.DEFAULT){const s=`--${e}-fg-${t}-color`,n=i.getPropertyValue(s);return""===n&&console.error(s," is not defined."),new ee(n)},getTextColor(e=K.ON_BACKGROUND){const t=`--text-${e}-color`,s=i.getPropertyValue(t);return""===s&&console.error(t," is not defined."),new ee(s)},getColor(e){const t=`--${e}-color`,s=i.getPropertyValue(t);return""===s&&console.error(t,"is not defined."),new ee(s)}}}();class he{constructor(e=0,t=0){this.x=e,this.y=t}copy(){return new he(this.x,this.y)}length_sqrd(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.length_sqrd())}set(e,t){return this.x=e,this.y=t,this}add(e){return new he(this.x+e.x,this.y+e.y)}addXY(e,t){return new he(this.x+e,this.y+t)}add_self(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return new he(this.x-e.x,this.y-e.y)}subXY(e,t){return new he(this.x-e,this.y-t)}sub_self(e){return this.x-=e.x,this.y-=e.y,this}scale(e,t){return t||(t=e),new he(this.x*e,this.y*t)}scale_self(e,t){return t||(t=e),this.x*=e,this.y*=e,this}dot(e){return this.x*e.x+this.y*e.y}toString(){return this.x+"i + "+this.y+"j"}}he.unit_x=Object.freeze(new he(1,0)),he.unit_y=Object.freeze(new he(0,1)),he.ZERO=Object.freeze(new he(0,0));class ce{constructor(e,t){this.width=e,this.height=t}scale(e){return new ce(this.width*e,this.height*e)}scale_self(e){return this.width*=e,this.height*=e,this}max(){return Math.max(this.width,this.height)}toString(){return this.width+"x"+this.height}set(e,t){this.width=e,this.height=t}copy(){return new ce(this.width,this.height)}}ce.ZERO=Object.freeze(new ce(0,0));class de{constructor(e,t,s){this.scene=e,this.class_name=s,this.pos=new he(0,0),this.is_color_animating=!1,this.color=new ee("#f00"),this.ctx=e.ctx,this.id=t,this.color_state=K.DEFAULT}highlight(){this.scene.animator.add(new ne(this,this.color,ae.getBgColor(this.getName(),K.HIGHLIGHTED))),this.color_state=K.HIGHLIGHTED}getName(){return this.class_name.toLowerCase()}update(e){this.is_color_animating||(this.color=ae.getBgColor(this.getName(),this.color_state))}drawPointVec(e,t="green"){const s=Math.sqrt(e.x**2+e.y**2);s>1&&this.drawArrow(100*e.x/s,100*e.y/s,t)}drawArrow(e,t,s="green"){if(0===e&&0===t)return;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.strokeStyle=s,this.ctx.moveTo(this.pos.x,this.pos.y);const i=this.pos.add(new he(e,t));this.ctx.lineTo(i.x,i.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawCircle(e,t,s,i,n=!1,r,o=1){if(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t,s,e,0,2*Math.PI),this.ctx.fillStyle=i,n){let e=this.ctx.strokeStyle;this.ctx.lineWidth=o,this.ctx.strokeStyle=r,this.ctx.strokeStyle=e,this.ctx.stroke()}this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}reset(){console.error("Reset not implemented for",this.constructor.name)}drawLine(e,t,s,i,n,r){this.ctx.save(),this.ctx.strokeStyle=r,this.ctx.lineWidth=n,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,i),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawText(e,t,s,i,n=1){this.ctx.save(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=`${n}em Arial`,this.ctx.fillStyle=i,this.ctx.fillText(e,t,s),this.ctx.restore()}drawRect(e,t,s,i,n="#000",r,o=0,a){this.ctx.save(),this.ctx.fillStyle=n,o>0&&(this.ctx.strokeStyle=r),this.ctx.beginPath(),this.ctx.roundRect(300,5,200,100,a),this.ctx.closePath(),this.ctx.restore()}}class le extends de{constructor(e,t,s){super(e,le.getEdgeKey(t.id,s.id),"edge"),this.start_node=t,this.end_node=s}static getEdgeKey(e,t){return[e,t].sort().join()}render(){this.drawLine(this.start_node.pos.x,this.start_node.pos.y,this.end_node.pos.x,this.end_node.pos.y,le.thickness,this.color.hex)}}function ue(e,t){const s=document.createElement("div");switch(t){case"info":s.style.backgroundColor="rgba(0,140,255,0.18)";break;case"warn":s.style.backgroundColor="rgba(255,241,0,0.18)";break;case"error":s.style.backgroundColor="rgba(255,0,0,0.18)";break;case"success":s.style.backgroundColor="rgba(55,255,0,0.18)";break;default:s.style.backgroundColor="rgba(0,0,0,0.18)"}return Object.assign(s.style,{minWidth:"100%",borderRadius:"8px",fontFamily:"sans-serif",width:"fit-content",justifyContent:"space-between",padding:"0.5em"}),s.innerText=`[${t}]\t\t\t${e}`,s}le.thickness=3;class _e{constructor(e,t){const s=document.createElement("div"),i=document.createElement("div");i.innerText=e,this.value_el=document.createElement("div"),s.append(i,this.value_el),Object.assign(s.style,{minWidth:"100%",display:"flex",borderRadius:"8px",backgroundColor:"rgba(255,255,255,0.04)",fontFamily:"sans-serif",width:"fit-content",justifyContent:"space-between",padding:"0.1em"}),Object.assign(i.style,{fontWeight:"bold",color:"#ececec",padding:"0.5em",minWidth:"max-content"}),Object.assign(this.value_el.style,{color:"#ffffff",padding:"0.5em",alignContent:"right"}),t.append(s)}set(e){this.value_el.innerText=e}}class me{constructor(e,t){this.center=e,this.half_dimension=t}static fromRect(e,t,s,i){return new me(new he(e+s/2,t+i/2),new ce(s/2,i/2))}update(e,t){this.center=e,this.half_dimension=t}updateRect(e,t,s,i){this.center.set(e+s/2,t+i/2),this.half_dimension.set(s/2,i/2)}containsPoint(e){return Math.abs(e.x-this.center.x)<=this.half_dimension.width&&Math.abs(e.y-this.center.y)<=this.half_dimension.height}intersectsAABB(e){return this.center.x-e.center.x<=this.half_dimension.width+e.half_dimension.width&&this.center.y-e.center.y<=this.half_dimension.height+e.half_dimension.height}toString(){return`${this.center} ${this.half_dimension}`}copy(){return new me(this.center.copy(),this.half_dimension.copy())}}class pe{constructor(e,t,s=10){this.id=e,this.point=t,this.mass=s}}setInterval(()=>{ge.ACCURACY=document.getElementById("accuracy-slider")?.valueAsNumber},100);class ge{constructor(e){this.mass=0,this.regions=[],this.has_sub_divisions=!1,this.region_name="",this.boundary=e,this.has_sub_divisions=!1}subdivide(){const e=this.boundary.half_dimension,t=this.boundary.center,s=new ge(new me(new he(t.x+e.width/2,t.y-e.height/2),this.boundary.half_dimension.scale(.5))),i=new ge(new me(new he(t.x-e.width/2,t.y-e.height/2),this.boundary.half_dimension.scale(.5))),n=new ge(new me(new he(t.x-e.width/2,t.y+e.height/2),this.boundary.half_dimension.scale(.5))),r=new ge(new me(new he(t.x+e.width/2,t.y+e.height/2),this.boundary.half_dimension.scale(.5)));this.regions.push(s,i,n,r),this.has_sub_divisions=!0}contains(e){return this.boundary.containsPoint(e)}insert(e){if(!this.boundary.containsPoint(e.point))return!1;if(!this.node&&!this.has_sub_divisions)return this.node=e,this.COM=e.point.copy(),this.mass=e.mass,!0;this.has_sub_divisions||this.subdivide(),this.region_name="";let t=!1;for(const e of this.regions)!t&&this.node&&e.insert(this.node)&&(t=!0,this.node=void 0),this.region_name+=e.node?.id??"";let s=!1;for(const t of this.regions)if(t.insert(e)){s=!0;break}if(s){const t=this.mass+e.mass;if(!this.COM)return!0;this.COM.scale_self(this.mass).add_self(e.point.scale(e.mass)).scale_self(1/t),this.mass=t}return s}getTotalForcesOnPoint(e,t){if(0===this.regions.length)return new he(0,0);const s=new he(0,0),i=this.getNodesInCircularRange(e.point,ge.FULL_ACCURACY_CIRCLE_RADIUS);for(const n of i)e.id!=n.id&&s.add_self(t(e,n));return s.add_self(this.getForceDueToRegions(e,t,i)),s}getForceDueToRegions(e,t,s=[],i=0){const n=new he(0,0),r=1-ge.ACCURACY;for(const o of this.regions){if(!o.COM||0===o.mass)continue;const a=o.COM.x-e.point.x,h=o.COM.y-e.point.y;let c=a*a+h*h;if(o.boundary.half_dimension.width/Math.sqrt(c)>=r&&o.has_sub_divisions)n.add_self(o.getForceDueToRegions(e,t,s,i+1));else{if(Math.abs(a)<1e-6&&Math.abs(h)<1e-6)continue;const s=new pe(o.region_name,o.COM,o.mass);n.add_self(t(e,s))}}return n}getNodesInRange(e){const t=[];if(!this.boundary.intersectsAABB(e))return t;if(!this.has_sub_divisions)return this.node&&e.containsPoint(this.node.point)&&t.push(this.node),t;for(const s of this.regions)t.push(...s.getNodesInRange(e));return t}getNodesInCircularRange(e,t){const s=[];if(!function(e,t,s){const i=s.center.x-s.half_dimension.width,n=s.center.x+s.half_dimension.width,r=s.center.y-s.half_dimension.height,o=s.center.y+s.half_dimension.height,a=Math.max(i,Math.min(e.x,n)),h=Math.max(r,Math.min(e.y,o)),c=e.x-a,d=e.y-h;return c*c+d*d<=t*t}(e,t,this.boundary))return s;if(!this.has_sub_divisions)return this.node&&function(e,t,s){const i=e.x-s.x,n=e.y-s.y;return i*i+n*n<=t*t}(e,t,this.node.point)&&s.push(this.node),s;for(const i of this.regions)s.push(...i.getNodesInCircularRange(e,t));return s}*getAllRegions(){if(yield this,this.has_sub_divisions)for(const e of this.regions)yield*e.getAllRegions()}toString(){}}ge.ACCURACY=.9,ge.FULL_ACCURACY_AREA=new ce(100,100),ge.FULL_ACCURACY_CIRCLE_RADIUS=100;class we extends de{constructor(e,t,s,i,n=""){super(e,t,"node"),this.attr_force=new he(0),this.repln_force=new he(0),this.alpha=1,this.position_change=new he(0,0),this.velocity=new he(0),this.force=new he(0),this.max_velocity=100,this.velocity_decay=.5,this.min_velocity=1,this.pos.set(s.x,s.y),this.text=n,this.radius=i,this.mass=1,this.quad_tree_node=new pe(t,this.pos,100)}update(e){super.update(20);const t=.02;this.force.x=this.attr_force.x+this.repln_force.x,this.force.y=this.attr_force.y+this.repln_force.y,this.force.scale_self(this.alpha);let s=C.clamp(this.force.x*t,-this.max_velocity,this.max_velocity),i=C.clamp(this.force.y*t,-this.max_velocity,this.max_velocity);this.velocity.x+=s,this.velocity.y+=i,this.velocity.scale_self(1-this.velocity_decay),Math.abs(this.velocity.x)<this.min_velocity&&(this.velocity.x=0),Math.abs(this.velocity.y)<this.min_velocity&&(this.velocity.y=0);const n=this.velocity.x*t,r=this.velocity.y*t;this.pos.x+=n,this.pos.y+=r,this.position_change.set(n,r),this.alpha-=this.alpha*we.alphaDecay,this.alpha<.001&&(this.alpha=0),this.repln_force.set(0,0),this.attr_force.set(0,0)}render(){this.drawCircle(this.radius,this.pos.x,this.pos.y,this.color.hex,!0,ae.getBgColor(this.getName(),K.BORDER).hex,1),this.drawText(this.id,this.pos.x,this.pos.y,ae.getTextColor(K.ON_PRIMARY).hex)}getDistanceFromPoint(e){const t=this.pos.subtract(e).length_sqrd();return Math.sqrt(t)}containsPoint(e,t){const s=this.pos,i=new he(e,t).sub_self(s).length_sqrd();return this.radius**2>i}}we.alphaDecay=.0016;const fe=!1;var ye;!function(e){e[e.Primary=0]="Primary",e[e.Auxiliary=1]="Auxiliary",e[e.Secondary=2]="Secondary"}(ye||(ye={}));class xe{constructor(e){this.location=new he,this.buttonsPressed=new Set,this.touches=[],this.isTouching=!1,this.onMouseMove=e=>{const t=this.element.getBoundingClientRect();this.location=new he(e.clientX-t.x,e.clientY-t.y)},this.onMouseDown=e=>{e.target===this.element&&this.buttonsPressed.add(e.button)},this.onMouseUp=e=>{this.buttonsPressed.delete(e.button)},this.onTouchStart=e=>{if(e.target!==this.element)return;const t=this.element.getBoundingClientRect();this.isTouching=!0,this.touches=Array.from(e.touches).map(e=>new he(e.clientX-t.x,e.clientY-t.y)),this.location=this.touches[0]},this.onTouchMove=e=>{const t=this.element.getBoundingClientRect();this.touches=Array.from(e.touches).map(e=>new he(e.clientX-t.x,e.clientY-t.y)),this.location=this.touches[0]},this.onTouchEnd=e=>{const t=this.element.getBoundingClientRect();this.touches=Array.from(e.touches).map(e=>new he(e.clientX-t.x,e.clientY-t.y)),this.isTouching=this.touches.length>0,this.touches.length>0&&(this.location=this.touches[0])},this.element=e,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchstart",this.onTouchStart,{passive:fe}),window.addEventListener("touchmove",this.onTouchMove,{passive:fe}),window.addEventListener("touchend",this.onTouchEnd),window.addEventListener("touchcancel",this.onTouchEnd)}isButtonDown(e){return this.buttonsPressed.has(e)}dispose(){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("touchcancel",this.onTouchEnd)}}const Ee=Object.freeze({x:0,y:0}),Te=new class{constructor(e){this.reactive_logger_map=new Map,this.container_el=document.createElement("div"),this.reactive_logger_container=document.createElement("div"),this.container_el.id=e;const t=document.createElement("h2");t.style.textAlign="center",t.style.padding="0.5em",t.innerText=e,Object.assign(this.container_el.style,{display:"flex",flexDirection:"column",width:"300px",minWidth:"50",maxWidth:"100vw",padding:"0.5em",overflow:"scroll",border:"1px solid #333",borderRadius:"8px",backgroundColor:"#000000",boxShadow:"0 0 40px rgba(0, 0, 0, 0.8)",fontFamily:"sans-serif",maxHeight:"90vh",minHeight:"50px",height:"fit-content",position:"fixed",top:"1em",left:"50%",resize:"both",scrollingBehavior:"none"}),this.container_el.classList.add("draggable"),document.body.append(this.container_el),this.container_el.append(t,this.reactive_logger_container)}setVisible(e){this.container_el.style.display=e?"flex":"none"}info(e){this.container_el.appendChild(ue(e,"info"))}warn(e){this.container_el.appendChild(ue(e,"warn"))}error(e){this.container_el.appendChild(ue(e,"error"))}getReactiveLog(e){let t=this.reactive_logger_map.get(e);return t||(t=new _e(e,this.reactive_logger_container),this.reactive_logger_map.set(e,t)),t}success(e){this.container_el.appendChild(ue(e,"success"))}}("scene-logger");Te.setVisible(!1);class Ne{constructor(e,t){this.func=e,this.wait_ms=t,this.lastCall=0,this.lastCall=-t}call(...e){const t=Date.now();t-this.lastCall>=this.wait_ms&&(this.lastCall=t,this.func(...e))}}class ve{constructor(){this.camera_updated=!0,this.onupdate=null,this._x=0,this._y=0,this._zoom=1}get x(){return this._x}set x(e){this._x=e,this.camera_updated=!0,this.onupdate&&this.onupdate()}get y(){return this._y}set y(e){this._y=e,this.camera_updated=!0,this.onupdate&&this.onupdate()}get zoom(){return this._zoom}set zoom(e){this._zoom=e,this.camera_updated=!0,this.onupdate&&this.onupdate()}}class Ce{constructor(e,t=!1){this.ctx=e,this.show_fps=t,this.animator=new oe,this.camera=new ve,this.target_frame_rate=60,this.nodes=new Map,this.edges=new Map,this.accumulated_alpha=0,this.accumulated_frame_time=0,this.accumulated_node_position_change=-1,this.fps=0,this.last_animation_call_time=0,this.drawable_selected=null,this.grid_size=new ce(100,100),this.prev_mouse_pos=new he,this.fps_counter=0,this.boundary_bounds=me.fromRect(0,0,0,0),this.required_half_size=new ce(0,0),this.offset=new he(0),this.dragging_camera=!1,this.is_zooming=!1,this.initial_touches=null,this.pinching_to_zoom=!1,this.repaint_drawables=!1,this.bounds_updated=!1,this.last_draw_image=null,this.is_loop_running=!1,this.viewport=me.fromRect(0,0,0,0),this.ctx.scale(devicePixelRatio,devicePixelRatio),this.show_fps=t,this.is_running=!1,this.debug_box_el=document.getElementById("debug-box"),this.debug_box_el.checked=!1,this.mouse_info=new xe(this.ctx.canvas),this.camera.onupdate=()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)},this.debounceSelectedNodeAlphaReset=new Ne((...e)=>{for(const t of e){if(!t||!this.force_quad_tree)return;t.alpha<.5&&(t.alpha=.5);for(const e of this.force_quad_tree.getNodesInCircularRange(t.pos,300)){const t=this.nodes.get(e.id);t&&t.alpha<.5&&(t.alpha=.6)}}},100),new ResizeObserver(()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)}).observe(this.ctx.canvas),this.start_btn=document.getElementById("start-btn"),this.start_btn&&this.start_btn.addEventListener("click",()=>{this.is_running?this.stop():this.start()}),this.ctx.canvas.addEventListener("mousedown",e=>this.handleMousePressed(e)),this.ctx.canvas.addEventListener("touchstart",e=>{this.initial_touches=e.touches,1===e.touches.length?this.handleMousePressed(e):(e.preventDefault(),this.handleMultiTouch(e))},{passive:!1}),this.ctx.canvas.addEventListener("wheel",e=>{e.shiftKey&&this.zoomAt(e.clientX*devicePixelRatio,e.clientY*devicePixelRatio,e.deltaY<0)},{passive:!1}),window.addEventListener("mouseup",()=>this.handleMouseUp()),window.addEventListener("touchend",()=>{this.handleMouseUp(),this.pinching_to_zoom=!1}),window.addEventListener("mousemove",e=>this.handleMouseMove(e),{passive:!1}),window.addEventListener("touchmove",e=>{Te.getReactiveLog("Touch count").set(e.touches[0].identifier.toString()),1===e.touches.length?this.handleMouseMove(e):this.handleMultiTouchMove(e)},{passive:!1})}getTransformedPoint(e,t){return new he(e/(this.camera.zoom*devicePixelRatio)+this.camera.x,t/(this.camera.zoom*devicePixelRatio)+this.camera.y)}async loop(e){const t=this.last_animation_call_time,s=e-this.last_animation_call_time;this.last_animation_call_time=e;let i=performance.now();this.is_running&&(this.update(s),this.animator.step(s));let n=performance.now();const r=n-i;i=performance.now(),this.render(),n=performance.now();const o=n-i;Te.getReactiveLog("Update Time(ms)").set(r.toString()),Te.getReactiveLog("Render Time(ms)").set(o.toString()),Te.getReactiveLog("FPS").set(this.fps.toString()),Te.getReactiveLog("Target FPS").set(this.target_frame_rate.toString()),Te.getReactiveLog("ZOOM").set(this.camera.zoom.toString()),Te.getReactiveLog("Camera").set(`${this.camera.x}i + ${this.camera.y}j`),Te.getReactiveLog("Accumulated Alpha").set(this.accumulated_alpha.toString()),Te.getReactiveLog("Nodes").set(this.nodes.size.toString()),Te.getReactiveLog("Edges").set(this.edges.size.toString()),Te.getReactiveLog("Bounds").set(this.boundary_bounds.half_dimension.toString());const a=e-t;this.accumulated_frame_time+=a,this.show_fps&&(this.accumulated_frame_time>=1e3?(this.accumulated_frame_time=0,this.fps=this.fps_counter,this.fps_counter=0):this.fps_counter+=1),requestAnimationFrame(e=>{this.loop(e)})}start(){this.is_running||(this.is_running=!0,this.last_animation_call_time=performance.now(),this.is_loop_running||this.loop(this.last_animation_call_time).then(()=>this.is_loop_running=!0),this.start_btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M14 19V5h4v14zm-8 0V5h4v14z"/></svg>')}stop(){this.render(),this.is_running=!1,this.accumulated_frame_time=0,this.fps=0,this.fps_counter=0,this.start_btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M8 17.175V6.825q0-.425.3-.713t.7-.287q.125 0 .263.037t.262.113l8.15 5.175q.225.15.338.375t.112.475t-.112.475t-.338.375l-8.15 5.175q-.125.075-.262.113T9 18.175q-.4 0-.7-.288t-.3-.712"/></svg>'}render(){const e=devicePixelRatio||1;if(this.ctx.setTransform(e*this.camera.zoom,0,0,e*this.camera.zoom,-this.camera.x*e*this.camera.zoom,-this.camera.y*e*this.camera.zoom),!this.camera.camera_updated&&!this.bounds_updated&&!this.repaint_drawables)if(this.last_draw_image){if(this.last_draw_image.complete){const t=this.getTransformedPoint(0,0),s=1/(this.camera.zoom*e);return this.ctx.drawImage(this.last_draw_image,t.x,t.y,this.ctx.canvas.width*s,this.ctx.canvas.height*s),void Te.getReactiveLog("Rendering").set("False")}}else this.ctx.canvas.toBlob(e=>{e&&(this.last_draw_image=new Image,this.last_draw_image.loading="eager",this.last_draw_image.src=URL.createObjectURL(e))},"image/png",1);Te.getReactiveLog("Rendering").set("True"),(this.camera.camera_updated||this.bounds_updated||this.repaint_drawables)&&(this.last_draw_image=null),this.camera.camera_updated=!1,this.repaint_drawables=!1;const t=this.ctx.canvas.width,s=this.ctx.canvas.height;this.ctx.save(),this.ctx.resetTransform(),this.ctx.fillStyle=ae.getBgColor("canvas").hex,this.ctx.fillRect(0,0,t,s),this.ctx.beginPath();const i=-this.camera.x*this.camera.zoom*e%(this.grid_size.width*this.camera.zoom*e),n=-this.camera.y*this.camera.zoom*e%(this.grid_size.height*this.camera.zoom*e);this.ctx.strokeStyle=ae.getColor("grid").hex,this.ctx.lineWidth=1;for(let n=i;n<t;n+=this.grid_size.width*this.camera.zoom*e)this.ctx.moveTo(n,0),this.ctx.lineTo(n,s);for(let i=n;i<s;i+=this.grid_size.height*this.camera.zoom*e)this.ctx.moveTo(0,i),this.ctx.lineTo(t,i);this.ctx.stroke(),this.ctx.restore(),this.ctx.save();const r=this.edges,o=this.nodes;for(const[,e]of r)(this.viewport.containsPoint(e.start_node.pos)||this.viewport.containsPoint(e.end_node.pos))&&e.render();for(const[,e]of o)this.viewport.containsPoint(e.pos)&&e?.render();if(this.force_quad_tree&&this.debug_box_el?.checked){this.ctx.beginPath(),this.ctx.setLineDash([]),this.ctx.strokeStyle=ae.getColor("debug").hex;let e=null;for(const t of this.force_quad_tree.getAllRegions())e=t.boundary,this.ctx.strokeRect(e.center.x-e.half_dimension.width,e.center.y-e.half_dimension.height,2*e.half_dimension.width,2*e.half_dimension.height),t.COM&&this.ctx.fillText(`${t.mass}`,t.COM.x,t.COM.y);e=this.viewport,this.ctx.strokeStyle="#00f",this.ctx.strokeRect(e.center.x-e.half_dimension.width,e.center.y-e.half_dimension.height,2*e.half_dimension.width,2*e.half_dimension.height),this.ctx.closePath()}this.ctx.restore()}update(e){this.accumulated_alpha<.001&&(this.accumulated_alpha=0);const t=new he;let s=0;this.accumulated_alpha=0;for(const[,e]of this.nodes)this.accumulated_alpha+=e.alpha,t.add_self(e.pos.scale(e.mass)),s+=e.mass;if(t.scale_self(1/s),0!==this.accumulated_alpha||this.bounds_updated||this.camera.camera_updated){this.force_quad_tree=new ge(this.boundary_bounds);for(const[,e]of this.nodes)this.force_quad_tree.insert(e.quad_tree_node);Te.getReactiveLog("Building quadtree").set("True"),this.repaint_drawables=!0,this.bounds_updated=!1}else Te.getReactiveLog("Building quadtree").set("False");if(0!==this.accumulated_alpha){for(const[,t]of this.edges){t.update(e);const s=t.start_node,i=t.end_node,n=Le(s,i);s.attr_force.x+=n.x,s.attr_force.y+=n.y,i.attr_force.x-=n.x,i.attr_force.y-=n.y}for(const[t,s]of this.nodes)if(this.drawable_selected!==s&&this.force_quad_tree.contains(s.pos)?this.force_quad_tree&&0!==this.accumulated_alpha&&(s.repln_force=this.force_quad_tree.getTotalForcesOnPoint(s.quad_tree_node,Ae)):(s.repln_force.set(0,0),s.attr_force.set(0,0)),s.update(e),0===this.accumulated_frame_time){const e=document.getElementById(t);e&&(e.innerHTML=`<div>id: ${s.id}</div><div>alpha: ${s.alpha}</div><div> pos: ${this.getTransformedPoint(s.pos.x,s.pos.y)} </div><div>vel: ${Math.round(1e3*s.velocity.x)/1e3}i + ${Math.round(1e3*s.velocity.y)/1e3}</div><div>force: ${Math.round(1e3*s.force.x)/1e3}i + ${Math.round(1e3*s.force.y)/1e3}</div>`)}}this.required_half_size.set(0,0);for(const[,e]of this.nodes)this.recheckQuadtreeBounds(e,t),0===e.position_change.x&&0===e.position_change.y&&0!==e.alpha&&(e.alpha=Math.max(0,e.alpha-.1*e.alpha));this.drawable_selected?(this.ctx.canvas.style.cursor="pointer",this.debounceSelectedNodeAlphaReset.call(this.drawable_selected)):this.ctx.canvas.style.cursor="default"}addNode(e,t,s){if(this.nodes.has(e))return!1;const i=new we(this,e,t,s);return this.nodes.set(e,i),this.debounceSelectedNodeAlphaReset.call(i),this.accumulated_alpha+=i.alpha,!0}handleMultiTouchMove(e){if(!this.pinching_to_zoom||2!==e.touches.length)return;if(!this.initial_touches)return void(this.initial_touches=e.touches);const t=(e,t)=>{const s=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(s*s+i*i)},s=t(this.initial_touches[0],this.initial_touches[1]),i=t(e.touches[0],e.touches[1]);if(0===s)return;const n=i/s,r=C.clamp(this.camera.zoom*n,Ce.MIN_ZOOM,Ce.MAX_ZOOM),o=(e.touches[0].clientX+e.touches[1].clientX)/2*devicePixelRatio,a=(e.touches[0].clientY+e.touches[1].clientY)/2*devicePixelRatio,h=this.getTransformedPoint(o,a);this.camera.zoom=r;const c=this.getTransformedPoint(o,a);this.camera.x+=h.x-c.x,this.camera.y+=h.y-c.y,this.initial_touches=e.touches}handleMultiTouch(e){2===e.touches.length&&(this.pinching_to_zoom=!0)}handleMouseUp(){this.drawable_selected=null,this.dragging_camera=!1}zoomAt(e,t,s){const i=this.camera.zoom+Ce.ZOOM_DELTA*this.camera.zoom*(s?1:-1);if(i>Ce.MAX_ZOOM||i<Ce.MIN_ZOOM)return;const n=this.camera.zoom,r=this.getTransformedPoint(e,t);this.animator.add(new re((s,i)=>{this.is_zooming=!i,this.camera.x=r.x-e/(devicePixelRatio*s),this.camera.y=r.y-t/(devicePixelRatio*s),this.camera.zoom=C.clamp(s,Ce.MIN_ZOOM,Ce.MAX_ZOOM)},n,i,100,se.linear))}addEdge(e,t){const s=this.nodes.get(e),i=this.nodes.get(t);return!(!s||!i||(this.edges.get(le.getEdgeKey(e,t))||(s.alpha=.5,i.alpha=.5,this.debounceSelectedNodeAlphaReset.call(s,i),this.edges.set(le.getEdgeKey(e,t),new le(this,s,i))),0))}handleMouseMove(e){const t=e instanceof MouseEvent?e:e.touches[0],s=this.getTransformedPoint(t.clientX*devicePixelRatio,t.clientY*devicePixelRatio),i=s.x-this.prev_mouse_pos.x,n=s.y-this.prev_mouse_pos.y;this.drawable_selected?(this.drawable_selected.pos.x+=i,this.drawable_selected.pos.y+=n,this.drawable_selected instanceof we&&this.drawable_selected.position_change.set(i,n),this.prev_mouse_pos.set(s.x,s.y)):this.dragging_camera&&(this.camera.x-=i,this.camera.y-=n,Te.getReactiveLog("mouse translate point").set(`${s.x}i+${s.y}j`))}recheckQuadtreeBounds(e,t){if(!this.boundary_bounds.containsPoint(e.pos)){const s=300,i=e.pos.subtract(this.boundary_bounds.center),n=Math.abs(i.dot(he.unit_x))+s,r=Math.abs(i.dot(he.unit_y))+s,o=Math.max(n,this.required_half_size.width),a=Math.max(r,this.required_half_size.height);this.boundary_bounds.center.set(t.x,t.y),this.boundary_bounds.half_dimension.set(o,a),this.required_half_size.set(o,a),Te.getReactiveLog("Required size").set(this.required_half_size.toString()),this.bounds_updated=!0}}updateViewportFromScreen(e,t){const s=100,i=e,n=t,r=this.getTransformedPoint(0,0),o=this.getTransformedPoint(i,n),a=o.x-r.x,h=o.y-r.y;this.viewport.updateRect(r.x-s,r.y-s,a+s,h+s),this.bounds_updated=!0}handleMousePressed(e){if(!this.nodes)return;const t=e instanceof MouseEvent?e:e.touches[0],s=this.getTransformedPoint(t.clientX*devicePixelRatio,t.clientY*devicePixelRatio);this.prev_mouse_pos.set(s.x,s.y);for(const[,e]of this.nodes)if(e.containsPoint(s.x,s.y)){this.drawable_selected=e;break}this.drawable_selected||(this.dragging_camera=!0)}removeNode(e){return this.nodes.delete(e)}highlightNode(e){const t=this.nodes.get(e);return!!t&&(t.highlight(),!0)}unhighlightNode(e){return!1}moveNode(e,t,s){return!1}labelNode(e,t){return!1}removeEdge(e,t){return this.edges.delete(le.getEdgeKey(e,t))}highlightEdge(e,t){const s=this.edges.get(le.getEdgeKey(e,t));return!!s&&(s.highlight(),!0)}unhighlightEdge(e,t){return!1}labelEdge(e,t,s){return!1}noop(){return!0}finished(){return!1}error(e){return!1}reset(){return!1}clear(){return this.nodes.clear(),this.edges.clear(),!0}}Ce.ZOOM_DELTA=.3,Ce.MIN_ZOOM=.1,Ce.MAX_ZOOM=10;const be=100,Se=0,Ie=1e4,Re=1e4;function Ae(e,t){const s=e.point.subtract(t.point),i=s.length_sqrd(),n=Math.atan2(s.y,s.x),r=Ie/(i+be)*t.mass*e.mass;return new he(Math.round(r*Math.cos(n)),Math.round(r*Math.sin(n)))}function Le(e,t){const s=(e.radius+t.radius+Se)**2,i=e.pos.subtract(t.pos),n=i.length_sqrd();if(n<.01)return Ee;const r=Re*(n-s);return{x:-Math.round(i.x/n*r),y:-Math.round(i.y/n*r)}}class Me{constructor(e){this.id=e}async execute(e){e.highlightNode(this.id)}}class ke{constructor(e,t){this.from_id=e,this.to_id=t}async execute(e){e.highlightEdge(this.from_id,this.to_id)}}class Oe{async execute(e){e.finished()}}class De{constructor(e,t){this.finished=!1,this.scene=e,this.step_time_ms=200,this.scene.start(),this.algorithm_name=t,this.generator=null,this.playing=!0}load(e){this.scene.clear();const t=new Set,s=document.getElementById("debug-data");s?s.textContent="":console.error("Debugging panel not found"),function(e,t,s=20){const i=t.ctx.canvas.getBoundingClientRect();let n=i.width/2,r=i.height/2,o=0,a=0,h=1,c=0,d=0,l=0;for(const i of e.getNodes()){let e=o*Math.cos(l)-0*Math.sin(l)+n,u=o*Math.sin(l)+0*Math.cos(l)+r;t.addNode(i,new he(e,u),20),c++,l+=d,c===h&&(a++,o=2*s*a,l=0,c=0,d=Math.acos(1-1/(2*a*a)),h=Math.round(2*Math.PI/d))}}(e,this.scene);for(const i of e.getNodes()){if(s){const e=document.createElement("div");e.id=i.toString(),e.classList.add("node"),s.append(e)}for(const s of e.getNeighbors(i))this.scene.addEdge(i,s),t.add(s);t.add(i)}const i=function*(e,t){const s=[],i=[[null,t]];for(;i.length>0;){const t=i.pop(),n=t[0],r=t[1];if(!s.includes(r)){yield new ke(n,r),yield new Me(r),s.push(r);for(const t of e.getNeighbors(r))s.includes(t)||i.push([r,t])}}return new Oe}(e,e.start_node),n=setInterval(()=>{const e=i.next();e.done?clearInterval(n):e.value.execute(this.scene)},this.step_time_ms)}stop(){}reset(){}start(){}}class Pe{constructor(e,t=!0){this.start_node=e,this.bidirectional=t,this.adjacency_mapping=new Map,this.addNode(e)}addNode(e){return this.adjacency_mapping.has(e)||this.adjacency_mapping.set(e,new Set),this}attach(e,t){this.addNode(e);let s=this.adjacency_mapping.get(e);for(const i of t)this.addNode(i),s?.add(i),this.bidirectional&&this.adjacency_mapping.get(i)?.add(e);return this}getNeighbors(e){return Array.from(this.adjacency_mapping.get(e)??[])}getNodes(){return Array.from(this.adjacency_mapping.keys())}toString(){let e="";for(const[t,s]of this.adjacency_mapping.entries())e+=`${t} → ${[...s].join(", ")}`;return e}}const Fe=new Pe("A").attach("A",["B","C","D"]).attach("B",["E","F"]),Be=new Pe("Cluster1").attach("Cluster1",["C1A","C1B","C1C"]).attach("C1A",["C1B","C1C"]).attach("C1B",["C1C"]).attach("Cluster2",["C2A","C2B","C2C"]).attach("C2A",["C2B","C2C"]).attach("C2B",["C2C"]).attach("Cluster3",["C3A","C3B","C3C"]).attach("C3A",["C3B","C3C"]).attach("C3B",["C3C"]).attach("Cluster1",["Cluster2"]).attach("Cluster2",["Cluster3"]),Ue=new Pe("Center").attach("Center",["N1","N2","N3","N4","N5","N6"]).attach("N1",["N2","N6"]).attach("N2",["N1","N3"]).attach("N3",["N2","N4"]).attach("N4",["N3","N5"]).attach("N5",["N4","N6"]).attach("N6",["N5","N1"]),He=new Pe("C1N1").attach("C1N1",["C1N2","C1N3","C1N4"]).attach("C1N2",["C1N5","C1N6"]).attach("C1N3",["C1N7","C1N8"]).attach("C1N4",["C1N9","C1N10"]).attach("C2N1",["C2N2","C2N3","C2N4"]).attach("C2N2",["C2N5","C2N6"]).attach("C2N3",["C2N7","C2N8"]).attach("C2N4",["C2N9","C2N10"]).attach("C3N1",["C3N2","C3N3","C3N4"]).attach("C3N2",["C3N5","C3N6"]).attach("C3N3",["C3N7","C3N8"]).attach("C3N4",["C3N9","C3N10"]).attach("C4N1",["C4N2","C4N3","C4N4"]).attach("C4N2",["C4N5","C4N6"]).attach("C4N3",["C4N7","C4N8"]).attach("C4N4",["C4N9","C4N10"]).attach("C5N1",["C5N2","C5N3","C5N4"]).attach("C5N2",["C5N5","C5N6"]).attach("C5N3",["C5N7","C5N8"]).attach("C5N4",["C5N9","C5N10"]).attach("C6N1",["C6N2","C6N3","C6N4"]).attach("C6N2",["C6N5","C6N6"]).attach("C6N3",["C6N7","C6N8"]).attach("C6N4",["C6N9","C6N10"]).attach("C7N1",["C7N2","C7N3","C7N4"]).attach("C7N2",["C7N5","C7N6"]).attach("C7N3",["C7N7","C7N8"]).attach("C7N4",["C7N9","C7N10"]).attach("C8N1",["C8N2","C8N3","C8N4"]).attach("C8N2",["C8N5","C8N6"]).attach("C8N3",["C8N7","C8N8"]).attach("C8N4",["C8N9","C8N10"]).attach("C9N1",["C9N2","C9N3","C9N4"]).attach("C9N2",["C9N5","C9N6"]).attach("C9N3",["C9N7","C9N8"]).attach("C9N4",["C9N9","C9N10"]).attach("C10N1",["C10N2","C10N3","C10N4"]).attach("C10N2",["C10N5","C10N6"]).attach("C10N3",["C10N7","C10N8"]).attach("C10N4",["C10N9","C10N10"]).attach("C1N1",["C2N1"]).attach("C2N1",["C3N1"]).attach("C3N1",["C4N1"]).attach("C4N1",["C5N1"]).attach("C5N1",["C6N1"]).attach("C6N1",["C7N1"]).attach("C7N1",["C8N1"]).attach("C8N1",["C9N1"]).attach("C9N1",["C10N1"]);class ze{}ze.MIN_SCREEN_WIDTH=740;const $e='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"/></svg>',We='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"/></svg>';document.addEventListener("DOMContentLoaded",()=>{let e=!0;const t=document.getElementById("canvas-container"),s=document.getElementById("main-canvas"),i=s.getContext("2d",{alpha:!1});if(!s)return;if(!i)return;const n=document.getElementById("toggle-btn"),r=document.getElementById("data-container"),o=document.getElementById("slider"),a=new Ce(i,!0);function h(){window.innerWidth>ze.MIN_SCREEN_WIDTH?(t?.classList.remove("hidden"),r?.classList.remove("hidden"),e=!0):e?(t?.classList.remove("hidden"),r?.classList.add("hidden"),e=!0):(t?.classList.add("hidden"),r?.classList.remove("hidden"),e=!1),window.innerWidth<=ze.MIN_SCREEN_WIDTH&&(e?a.start():a.stop())}function c(e){if(!t)return;const s=window.devicePixelRatio||1,i=t.getBoundingClientRect(),n=e.getTransform();e.canvas.width=Math.round(i.width*s),e.canvas.height=Math.round(i.height*s),e.setTransform(n),Te.getReactiveLog("CanvasSize").set(`${e.canvas.offsetWidth}x${e.canvas.offsetHeight}`),Te.getReactiveLog("CanvasContainerSize").set(`${t.offsetWidth}x${t.offsetHeight}`),a.render()}!function(){const e=document.getElementById("fullscreen-btn");let t=!1;e?.addEventListener("click",()=>{t=null!==document.fullscreenElement,t?document.exitFullscreen().then(()=>{e.innerHTML=$e,t=!1}):document.body.requestFullscreen().then(()=>{e.innerHTML=We,t=!0})}),document.body.addEventListener("fullscreenchange",s=>{t=null!==document.fullscreenElement,e.innerHTML=t?We:$e})}(),window.addEventListener("resize",()=>{t.style.width="",h(),c(i)}),window.addEventListener("orientationchange",()=>{t.style.width="",h(),c(i)});let d=!1;o?.addEventListener("mousedown",()=>{document.body.style.cursor="ew-resize",d=!0}),o?.addEventListener("touchstart",()=>{d=!0}),window.addEventListener("mouseup",()=>{d=!1,document.body.style.cursor="default",c(i)}),window.addEventListener("touchend",()=>{d=!1,c(i)}),window.addEventListener("mousemove",e=>{if(t&&!(window.innerWidth<=ze.MIN_SCREEN_WIDTH)&&d&&e.clientX<window.innerWidth&&e.clientX>0){const s=e.pageX;t.style.width=`${s}px`,c(i),e.preventDefault(),e.stopImmediatePropagation()}}),window.addEventListener("touchmove",e=>{const s=e.touches[0];if(t&&!(window.innerWidth<=ze.MIN_SCREEN_WIDTH)&&d&&s.clientX<window.innerWidth&&s.clientX>0){const n=s.pageX;t.style.width=`${n}px`,c(i),e.preventDefault(),e.stopImmediatePropagation()}}),n?.addEventListener("click",()=>{e?(t?.classList.add("hidden"),r?.classList.remove("hidden")):(t?.classList.remove("hidden"),r?.classList.add("hidden")),e=!e,e?a.start():a.stop()}),ae.setThemeType(V.DARK),t&&o&&window.innerWidth>ze.MIN_SCREEN_WIDTH&&(t.style.width=`${o.getBoundingClientRect().x}px`),c(i),h();const l=new De(a,"DFS Graph Traversal"),u=document.getElementById("config-dropdown");if(u){const e={simple:Fe,"clustered small":Be,"spider web":Ue,"large clustered":He};for(const t in e){const e=document.createElement("option");e.innerText=t,u.appendChild(e)}u.value=u.options[3].value,l.load(e[u.value]),u.addEventListener("change",()=>{l.load(e[u.value]),console.log("changing")}),function(){const e=document.getElementById("code-area"),t=new J(e);document.getElementById("code-runner-btn").onclick=()=>{t.run()}}()}})})();