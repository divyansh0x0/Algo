(()=>{"use strict";var t={49:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(601),n=i.n(s),a=i(314),o=i.n(a)()(n());o.push([t.id,"@import url(https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap);"]),o.push([t.id,':root{--yasl-editor-selection-color: rgba(70, 136, 255, 0.42);--yasl-identifier-color: #7bfbdd;--yasl-symbol-color: #e81111;--yasl-operator-color: #d996ff;--yasl-keyword-color: #e4ab85;--yasl-whitespace-color: #fff;--yasl-string-color: #a8ff8d;--yasl-repl-border-radius: 10px;--yasl-editor-font-size: 1rem;--yasl-caret-color: #fff;--yasl-loader-bg: rgb(53, 53, 53)}.yasl-editor{caret-color:rgba(0,0,0,0) !important;width:fit-content;min-width:100%;min-height:100%;height:fit-content;padding:0;display:flex;flex-direction:column;outline:none;font-family:"JetBrains Mono",monospace;font-size:var(--yasl-editor-font-size);overflow:hidden;pointer-events:none;user-select:none}.yasl-editor .yasl-ide-loader{width:100%;height:100%;background:var(--yasl-loader-bg);position:absolute;z-index:1;opacity:1;transition:opacity 100ms linear,visibility 150ms linear}.yasl-editor.ready{pointer-events:auto}.yasl-editor.ready .yasl-ide-loader{opacity:0;visibility:hidden}.yasl-editor *{box-sizing:border-box;font-family:"JetBrains Mono",monospace;font-size:var(--yasl-editor-font-size)}.yasl-editor:focus .caret{display:block}.yasl-editor .caret{position:absolute;top:0;left:0;width:3px;height:1em;background:var(--yasl-caret-color);animation:blink 1s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}.yasl-editor .caret.typing{animation:none}.yasl-editor .yasl-ide-selection-el{background-color:var(--yasl-editor-selection-color);position:absolute}.yasl-editor .yasl-editor-row{width:100%;height:min-content;outline:none;background:rgba(0,0,0,.22);min-height:var(--yasl-editor-font-size);min-width:100%;padding:0;white-space:pre}.yasl-editor .yasl-editor-row:focus{background:rgba(0,0,0,.42)}.yasl-editor .yasl-editor-row .identifier{color:var(--yasl-identifier-color)}.yasl-editor .yasl-editor-row .whitespace{color:var(--yasl-whitespace-color)}.yasl-editor .yasl-editor-row .keyword{color:var(--yasl-keyword-color)}.yasl-editor .yasl-editor-row .operator{color:var(--yasl-operator-color)}.yasl-editor .yasl-editor-row .string{color:var(--yasl-string-color)}.yasl-editor .yasl-editor-row .number{color:var(--yasl-string-color)}.yasl-editor .yasl-editor-row .symbol{color:var(--yasl-symbol-color)}',""]);const r=o},56:(t,e,i)=>{t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function i(t){for(var i=-1,s=0;s<e.length;s++)if(e[s].identifier===t){i=s;break}return i}function s(t,s){for(var a={},o=[],r=0;r<t.length;r++){var h=t[r],c=s.base?h[0]+s.base:h[0],l=a[c]||0,d="".concat(c," ").concat(l);a[c]=l+1;var u=i(d),m={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var _=n(m,s);s.byIndex=r,e.splice(r,0,{identifier:d,updater:_,references:1})}o.push(d)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var a=s(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<a.length;o++){var r=i(a[o]);e[r].references--}for(var h=s(t,n),c=0;c<a.length;c++){var l=i(a[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}a=h}}},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i="",s=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),s&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),s&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i}).join("")},e.i=function(t,i,s,n,a){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(s)for(var r=0;r<this.length;r++){var h=this[r][0];null!=h&&(o[h]=!0)}for(var c=0;c<t.length;c++){var l=[].concat(t[c]);s&&o[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),i&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=i):l[2]=i),n&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=n):l[4]="".concat(n)),e.push(l))}},e}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,i){var s=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},705:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(601),n=i.n(s),a=i(314),o=i.n(a)()(n());o.push([t.id,".yasl-repl-container{width:100%;height:100%;display:flex;flex-direction:column;gap:1em}.yasl-repl-container .yasl-repl-input{background-color:rgba(0,0,0,.22);border-radius:var(--yasl-repl-border-radius);width:100%;height:100%;min-height:3em;padding:0;outline:1px solid rgba(0,0,0,0);transition:outline-color 100ms linear;cursor:text}.yasl-repl-container .yasl-repl-input.focused{outline:1px solid #fff}.yasl-repl-container .yasl-repl-output{width:100%;height:100%;border:1px solid rgba(0,0,0,.99)}",""]);const r=o},805:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(601),n=i.n(s),a=i(314),o=i.n(a)()(n());o.push([t.id,"#yasl-keyboard{width:10px;height:100px;background:#000;position:fixed;bottom:0;right:0;transition:width 100ms linear}#yasl-keyboard.open{width:90vw}",""]);const r=o},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var s="";i.supports&&(s+="@supports (".concat(i.supports,") {")),i.media&&(s+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(s+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),s+=i.css,n&&(s+="}"),i.media&&(s+="}"),i.supports&&(s+="}");var a=i.sourceMap;a&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleTagTransform(s,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={id:s,exports:{}};return t[s](a,a.exports,i),a.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nc=void 0;var s,n,a,o,r,h,c,l,d=i(72),u=i.n(d),m=i(825),_=i.n(m),p=i(659),g=i.n(p),f=i(56),w=i.n(f),y=i(540),v=i.n(y),x=i(113),N=i.n(x),E=i(49),C={};C.styleTagTransform=N(),C.setAttributes=w(),C.insert=g().bind(null,"head"),C.domAPI=_(),C.insertStyleElement=v(),u()(E.A,C),E.A&&E.A.locals&&E.A.locals,function(t){t.Alt="Alt",t.CapsLock="CapsLock",t.Ctrl="Control",t.Backspace="Backspace",t.Delete="Delete",t.Undefined="Unidentified",t.Shift="Shift",t.Enter="Enter",t.Tab="Tab",t.Space=" ",t.ARROW_DOWN="ArrowDown",t.ARROW_UP="ArrowUp",t.ARROW_LEFT="ArrowLeft",t.ARROW_RIGHT="ArrowRight",t.Home="Home",t.End="End"}(s||(s={}));class T{static countLeadingWhitespaces(t){let e=0;for(;e<t.length&&/\s/.test(t[e]);)e++;return e}static countTrailingWhitespaces(t){let e=t.length-1;for(;e>=0&&/\s/.test(t[e]);)e--;return t.length-1-e}}class b{static roundedClamp(t,e,i){return b.clamp(Math.round(t),e,i)}static clamp(t,e,i){return Math.max(Math.min(t,i),e)}static round(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}}(c=n||(n={})).IDENTIFIER="identifier",c.LITERAL="literal",c.CALL="call",c.BREAK_STATEMENT="breakStatement",c.CONTINUE_STATEMENT="continueStatement",c.DECLARATION_STATEMENT="declarationStatement",c.ASSIGNMENT="assignmentExpression",c.FUNCTION_DEFINITION="functionDefinition",c.RETURN_STATEMENT="returnStatement",c.FOR_STATEMENT="forStatement",c.WHILE_STATEMENT="whileStatement",c.THEN_STATEMENT="thenStatement",c.IF_STATEMENT="ifStatement",c.ELSE_STATEMENT="elseStatement",c.ELSE_IF_STATEMENT="elseIfStatement",c.SWITCH_STATEMENT="switchStatement",c.SWITCH_CASE_STATEMENT="switchCaseStatement",c.BINARY_EXPRESSION="binaryExpression",c.UNARY_EXPRESSION="unaryExpression",c.BLOCK_STATEMENT="blockStatement",c.TERNARY_EXPRESSION="ternaryExpression",c.PROPERTY_ACCESS="propertyAccess",c.POSTFIX_OPERATION="postfixOperation",(h=a||(a={})).string="string",h.number="number",h.boolean="boolean",h.queue="Queue",h.set="Set",h.array="array",h.function_signature="function",h.unset="";class A{static isIdentifier(t){return t.type===n.IDENTIFIER}static isPropertyAccess(t){return t.type===n.PROPERTY_ACCESS}static isLValue(t){return t.type===n.PROPERTY_ACCESS||t.type===n.IDENTIFIER}static isExpression(t){switch(t.type){case n.BINARY_EXPRESSION:case n.ASSIGNMENT:case n.TERNARY_EXPRESSION:case n.UNARY_EXPRESSION:case n.LITERAL:return!0;default:return!1}}}function R(t){switch(t){case r.PLUS:case r.MINUS:case r.MULTIPLY:case r.DIVIDE:case r.MODULO:case r.POWER:case r.PLUS_ASSIGN:case r.MINUS_ASSIGN:case r.MULTIPLY_ASSIGN:case r.DIVIDE_ASSIGN:case r.MOD_ASSIGN:case r.POW_ASSIGN:case r.EQUAL_EQUAL:case r.NOT_EQUAL:case r.LESS_THAN:case r.GREATER_THAN:case r.LESS_THAN_EQUAL_TO:case r.GREATER_THAN_EQUAL_TO:case r.AND:case r.OR:case r.NOT:case r.BIT_AND:case r.BIT_OR:case r.BIT_NOT:case r.BIT_XOR:case r.BIT_SHIFT_LEFT:case r.BIT_SHIFT_RIGHT:case r.INCREMENT:case r.DECREMENT:case r.NEGATE:case r.ASSIGN:case r.INLINE_ASSIGN:return"operator";case r.NUMBER:return"number";case r.STRING:return"string";case r.WHITESPACE:return"whitespace";case r.NULL:case r.TRUE:case r.FALSE:case r.LET:case r.IF:case r.ELSE:case r.SWITCH:case r.CASE:case r.DEFAULT:case r.FOR:case r.WHILE:case r.THEN:case r.DO:case r.BREAK:case r.CONTINUE:case r.IN:case r.INSTANCEOF:case r.FUNCTION:case r.RETURN:return"keyword";case r.LPAREN:case r.RPAREN:case r.LBRACKET:case r.RBRACKET:case r.LBRACE:case r.RBRACE:case r.COMMA:case r.DOT:case r.COLON:case r.STATEMENT_END:return"symbol";case r.IDENTIFIER:return"identifier";case r.EOF:return"eof";default:return"unknown"}}!function(t){t.Reset="[0m",t.Bright="[1m",t.Dim="[2m",t.Underscore="[4m",t.Blink="[5m",t.Reverse="[7m",t.Hidden="[8m",t.FgBlack="[30m",t.FgRed="[31m",t.FgGreen="[32m",t.FgYellow="[33m",t.FgBlue="[34m",t.FgMagenta="[35m",t.FgCyan="[36m",t.FgWhite="[37m",t.FgGray="[90m",t.BgBlack="[40m",t.BgRed="[41m",t.BgGreen="[42m",t.BgYellow="[43m",t.BgBlue="[44m",t.BgMagenta="[45m",t.BgCyan="[46m",t.BgWhite="[47m",t.BgGray="[100m"}(o||(o={})),(l=r||(r={})).WHITESPACE=" ",l.STATEMENT_END=";",l.EQUAL_EQUAL="==",l.NOT_EQUAL="!=",l.LESS_THAN="<",l.GREATER_THAN=">",l.LESS_THAN_EQUAL_TO="<=",l.GREATER_THAN_EQUAL_TO=">=",l.ASSIGN="=",l.INLINE_ASSIGN=":=",l.PLUS_ASSIGN="+=",l.MINUS_ASSIGN="-=",l.MULTIPLY_ASSIGN="*=",l.DIVIDE_ASSIGN="/=",l.MOD_ASSIGN="%=",l.POW_ASSIGN="**=",l.PLUS="+",l.MINUS="-",l.MULTIPLY="*",l.DIVIDE="/",l.MODULO="%",l.POWER="**",l.AND="and",l.OR="or",l.NOT="not",l.BIT_AND="&",l.BIT_OR="|",l.BIT_NOT="~",l.BIT_XOR="^",l.BIT_SHIFT_LEFT="<<",l.BIT_SHIFT_RIGHT=">>",l.INCREMENT="++",l.DECREMENT="--",l.NEGATE="!",l.NUMBER="number",l.STRING="string",l.NULL="null",l.LET="let",l.IF="if",l.ELSE="else",l.SWITCH="switch",l.CASE="case",l.DEFAULT="default",l.FOR="for",l.WHILE="while",l.THEN="then",l.DO="do",l.BREAK="break",l.CONTINUE="continue",l.IN="in",l.INSTANCEOF="instanceof",l.FUNCTION="fn",l.RETURN="return",l.TRUE="true",l.FALSE="false",l.LPAREN="(",l.RPAREN=")",l.LBRACKET="[",l.RBRACKET="]",l.LBRACE="{",l.RBRACE="}",l.COMMA=",",l.DOT=".",l.COLON=":",l.IDENTIFIER="identifier",l.EOF="\0";const S=Object.freeze(new Map([["let",r.LET],["switch",r.SWITCH],["if",r.IF],["else",r.ELSE],["case",r.CASE],["default",r.DEFAULT],["for",r.FOR],["while",r.WHILE],["do",r.DO],["break",r.BREAK],["continue",r.CONTINUE],["in",r.IN],["instanceof",r.INSTANCEOF],["fn",r.FUNCTION],["return",r.RETURN],["true",r.TRUE],["false",r.FALSE],["in",r.IN],["and",r.AND],["or",r.OR],["not",r.NOT],["null",r.NULL],["then",r.THEN]]));class I{constructor(t){this.text=t,this.tokens_list=Array(),this.curr_line=0,this.curr_col=0,this.start_read_index=0,this.next_read_index=0,this.end_of_literal_regex=/[\s\n(){},.:;+/*%&|^<=>!\-\[\]]/,this.whitespace_regex=/\s/,this.is_analysis_complete=!1,this._errors=Array()}get errors(){return this._errors}getTokens(){for(;!this.isEOF();)this.start_read_index=this.next_read_index,this.scanToken();return this.is_analysis_complete||(this.start_read_index=this.next_read_index,this.is_analysis_complete=!0,this.addToken(r.EOF)),this.tokens_list}getLastToken(){return this.tokens_list[this.tokens_list.length-1]}scanToken(){const t=this.consume();if(t.match(/[a-zA-Z_]/))this.consume_identifier(t);else if(t.match(/[0-9]/))this.consume_number(t);else switch(t){case";":case"\n":this.addToken(r.STATEMENT_END,null);break;case"(":case")":case"[":case"]":case"{":case"}":case".":case",":case"&":case"|":case"^":case"~":this.addToken(t);break;case":":"="==this.peek()?(this.consume(),this.addToken(r.INLINE_ASSIGN)):this.addToken(r.COLON);break;case"=":"="==this.peek()?(this.consume(),this.addToken(r.EQUAL_EQUAL)):this.addToken(r.ASSIGN);break;case"<":"="==this.peek()?(this.consume(),this.addToken(r.LESS_THAN_EQUAL_TO)):"<"==this.peek()?(this.consume(),this.addToken(r.BIT_SHIFT_LEFT)):this.addToken(r.LESS_THAN);break;case">":"="==this.peek()?(this.consume(),this.addToken(r.GREATER_THAN_EQUAL_TO)):">"==this.peek()?(this.consume(),this.addToken(r.BIT_SHIFT_RIGHT)):this.addToken(r.GREATER_THAN);break;case"!":"="==this.peek()?(this.consume(),this.addToken(r.NOT_EQUAL)):this.addToken(r.NEGATE);break;case"+":"="==this.peek()?(this.consume(),this.addToken(r.PLUS_ASSIGN)):"+"==this.peek()?(this.consume(),this.addToken(r.INCREMENT)):this.addToken(r.PLUS);break;case"-":"="==this.peek()?(this.consume(),this.addToken(r.MINUS_ASSIGN)):"-"==this.peek()?(this.consume(),this.addToken(r.DECREMENT)):this.addToken(r.MINUS);break;case"*":"="==this.peek()?(this.consume(),this.addToken(r.MULTIPLY_ASSIGN)):"*"==this.peek()?(this.consume(),"="==this.peek()?(this.consume(),this.addToken(r.POW_ASSIGN)):this.addToken(r.POWER)):this.addToken(r.MULTIPLY);break;case"%":"="==this.peek()?(this.consume(),this.addToken(r.MOD_ASSIGN)):this.addToken(r.MODULO);break;case"/":switch(this.peek()){case"/":for(this.consume();!this.isEOF()&&"\n"!==this.peek();)this.consume();break;case"=":this.consume(),this.addToken(r.DIVIDE_ASSIGN);break;default:this.addToken(r.DIVIDE)}break;case'"':case"'":this.consume_string(t);break;default:if(t.match(this.whitespace_regex)){for(;this.peek().match(this.whitespace_regex);)this.consume();this.addToken(r.WHITESPACE);break}this.error(`Invalid token "${t}"`)}}isEOF(){return this.text.length-1<this.next_read_index}error(t){this._errors.push({column:this.curr_col,highlight:this.getCurrentColumnHighlighted(),line:this.curr_line,message:t})}getCurrentColumnHighlighted(){let t=this.next_read_index-1,e=this.text.lastIndexOf("\n",t)+1,i=this.text.indexOf("\n",t);-1===i&&(i=this.text.length);const s=this.text.slice(e,i),n=this.next_read_index-1-e,a=s.trim(),o=s.length-s.trimStart().length;return a+"\n"+" ".repeat(n-o)+"^"}peek(){return this.isEOF()?"\0":this.text[this.next_read_index]}consume(){if(this.isEOF())return"\0";const t=this.text[this.next_read_index];return"\n"===t&&(this.curr_line++,this.curr_col=0),this.next_read_index++,this.curr_col++,t}addToken(t,e=null){const i=this.text.slice(this.start_read_index,this.next_read_index);this.tokens_list.push({type:t,lexeme:i,literal:e,line:this.curr_line,start:this.start_read_index,end:this.next_read_index})}consume_identifier(t){const e=/[a-zA-Z0-9_]/;let i=t;for(;!this.isEOF();){const t=this.peek();if(!t.match(e))break;i+=t,this.consume()}S.has(i)?"true"===i?this.addToken(r.TRUE,!0):"false"===i?this.addToken(r.FALSE,!1):"null"===i?this.addToken(r.NULL,null):this.addToken(i,i):this.addToken(r.IDENTIFIER,i)}consume_number(t){const e=/[0-9_]/;let i=!1,s=t,n=t;for(;!this.isEOF();){if(n=this.peek(),n.match(e))"_"!==n&&(s+=n);else{if("."!=n)break;if(i){this.error("Invalid decimal after a decimal number");break}i=!0,s+=n}this.consume()}this.addToken(r.NUMBER,parseInt(s))}consume_string(t){let e="";for(;!this.isEOF();){const i=this.consume();if(i===t)break;if("\n"==i)return void this.error(`Invalid newline in single line string after ${e}`);if("\0"==i)return void this.error(`Reached end of file after ${e}`);if("\\"===i)switch(this.consume()){case"n":e+="\n";break;case"t":e+="\t";break;case"\r":e+="\r";break;case"\\":e+="\\";break;case"'":e+="'"}else e+=i}this.addToken(r.STRING,e)}}var M,L;!function(t){t[t.AlreadyDefined=0]="AlreadyDefined",t[t.Success=1]="Success",t[t.NotDefined=2]="NotDefined"}(M||(M={})),function(t){t[t.Node=0]="Node",t[t.Native=1]="Native",t[t.Environment=2]="Environment"}(L||(L={}));class k{constructor(){this.variable_map=new Map}define(t,e){return this.variable_map.has(t)?M.AlreadyDefined:(this.variable_map.set(t,{type:L.Native,value:e}),M.Success)}defineScope(t,e){return this.variable_map.has(t)?M.AlreadyDefined:(this.variable_map.set(t,{type:L.Environment,value:e}),M.Success)}mutate(t,e){return this.variable_map.has(t)?(this.variable_map.set(t,{type:L.Native,value:e}),M.Success):M.NotDefined}mutateScope(t,e){return this.variable_map.has(t)?(this.variable_map.set(t,{type:L.Environment,value:e}),M.Success):M.NotDefined}get(t){var e;return null!==(e=this.variable_map.get(t))&&void 0!==e?e:null}}class O{constructor(){this.next_node=null,this.current_scope=new k,this.statement_callback=null,this.line=0}attachStatementCallback(t){this.statement_callback=t}run(t){for(this.line=0,this.next_node=t;!this.isEnd();){const t=this.consumeNode();if(!t)break;this.parseStatement(t),this.line++}}isEnd(){return null===this.next_node}parseStatement(t){let e=null;switch(t.type){case n.DECLARATION_STATEMENT:e=this.parseDeclaration(t);break;case n.ASSIGNMENT:e=this.parseAssignment(t);break;case n.CALL:e=this.parseFunction(t);break;default:A.isExpression(t)?e=this.parseExpression(t):this.error("Invalid statement",t)}this.statement_callback&&this.statement_callback({result:e,line:this.line})}parseExpression(t){let e=null;switch(t.type){case n.UNARY_EXPRESSION:e=this.parseUnaryExpression(t);break;case n.BINARY_EXPRESSION:e=this.parseBinaryExpression(t);break;case n.ASSIGNMENT:e=this.parseAssignment(t);break;case n.LITERAL:e=this.parseLiteral(t)}return e||(this.error("Invalid expression",t),null)}parseLiteral(t){switch(t.valueType){case a.number:case a.string:case a.boolean:return t.value;default:this.error("Not implemented",t)}return null}parseAssignment(t){const e=t.lvalue,i=this.parseExpression(t.rvalue);return A.isIdentifier(e)?this.handleEnvironmentReturnCode(this.current_scope.mutate(e.name,i),e):A.isPropertyAccess(e)&&this.error("Not implemented",e),console.log("Assigned ",i,"to",e),i}parseDeclaration(t){if(t.rvalue){const e=this.parseExpression(t.rvalue);return this.current_scope.define(t.lvalue,e),e}return this.current_scope.define(t.lvalue,null),console.log("Assigned ",t.rvalue,"to",t.lvalue),null}parseBinaryExpression(t){let e=null;const i=this.parseExpression(t.expression_left),s=this.parseExpression(t.expression_right);switch(t.op){case r.MINUS:"number"==typeof i&&"number"==typeof s?e=s-i:this.valueError(a.number,t);break;case r.PLUS:"number"==typeof i&&"number"==typeof s?e=s+i:this.valueError(a.number,t);break;case r.MULTIPLY:"number"==typeof i&&"number"==typeof s?e=s*i:this.valueError(a.number,t);break;case r.DIVIDE:"number"==typeof i&&"number"==typeof s?e=s/i:this.valueError(a.number,t);break;case r.MODULO:"number"==typeof i&&"number"==typeof s?e=s%i:this.valueError(a.number,t);break;case r.AND:case r.OR:"boolean"==typeof i&&"boolean"==typeof s?e=s&&i:this.valueError(a.number,t);break;default:this.error("Invalid unary operator",t)}return e}parseUnaryExpression(t){let e=null;const i=this.parseExpression(t.expression);switch(t.op){case r.NEGATE:"boolean"==typeof i||"number"==typeof i?e=!i:this.valueError(a.boolean,t);break;case r.MINUS:"number"==typeof i?e=-1*i:this.valueError(a.number,t);break;case r.BIT_NOT:"number"==typeof i?e=~i:this.valueError(a.number,t);break;default:this.error("Invalid unary operator",t)}return e}getIdentifierValue(t){this.current_scope.get(t.name)}getPropertyValue(t){this.error("Not implemented get property value",t)}parseFunction(t){const e=t.identifier;if(A.isIdentifier(e)){if("print"===e.name)for(const e of t.args)console.log(e)}else this.error("Not implemented",t);return null}consumeNode(){const t=this.next_node;return t&&(this.next_node=null==t?void 0:t.next_node),t}error(t,e){throw Error(t)}valueError(t,e){throw Error(t)}handleEnvironmentReturnCode(t,e){switch(t){case M.AlreadyDefined:this.error("Redeclaration of same LValue is not allowed",e);break;case M.NotDefined:this.error("LValue not defined",e);break;case M.Success:break;default:this.error("Unknown error occurred",e)}}}class P{get char_width(){return this._char_width}get line_height(){return this._line_height}constructor(t,e){this.primary_row=e,this.spawned_carets=[],this.is_typing_timer_id=null,this._char_width=0,this._line_height=0,this.primary_caret=new D(t)}moveCol(t){const e=this.primary_row.raw.length,i=b.clamp(this.primary_caret.column+t,0,e);this.primary_caret.setColumn(i),this.primary_row.setColumn(i),this.restartTypingTimer()}setColumn(t){const e=this.primary_row.raw.length;let i;i=t>=0?b.clamp(t,0,e):b.clamp(e-t+1,0,e),this.primary_caret.setColumn(i),this.primary_row.setColumn(i),this.restartTypingTimer()}setRow(t){this.primary_row=t;const e=this.primary_row.raw.length,i=b.clamp(this.primary_caret.column,0,e);this.primary_row.setColumn(i),this.primary_caret.setColumn(i),this.primary_caret.setRow(this.primary_row.getDomNode()),this.restartTypingTimer()}setFontMetrics(t,e){this.primary_caret.setCharWidth(t),this.primary_caret.setLineHeight(e),console.log("IDE Font metrics updated from",this._char_width,"to",t),this._char_width=t,this._line_height=e,this.primary_caret.updateCaretPosition()}moveColToWordEnd(){const t=this.primary_row.tokens,e=this.primary_caret.column;for(const i of t)if(e<i.end){this.setColumn(i.end);break}}restartTypingTimer(){this.is_typing_timer_id&&clearTimeout(this.is_typing_timer_id),this.primary_caret.typing=!0,this.is_typing_timer_id=setTimeout(()=>{this.primary_caret.typing=!1},1e3)}}class D{get column(){return this._column}constructor(t){this.parent=t,this.row_el=null,this.caret=document.createElement("div"),this.char_width=10,this._column=0,this.line_height=10,this.text_before_caret="",this._typing=!1,this.caret.classList.add("caret"),t.append(this.caret),t.style.position="relative"}setRow(t){this.row_el=t,this.updateCaretPosition()}setColumn(t){this._column=t,this.updateCaretPosition()}updateCaretPosition(){this.row_el&&(this.caret.style.top=this.row_el.offsetTop.toString()+"px",this.caret.style.left=(this._column*this.char_width).toString()+"px")}moveBy(t){this._column=Math.max(this._column+t,0),this.updateCaretPosition()}setLineHeight(t){this.line_height=t,this.caret.style.height=this.line_height+"px"}setCharWidth(t){this.char_width=t}get typing(){return this._typing}set typing(t){this._typing=t,t?this.caret.classList.add("typing"):this.caret.classList.remove("typing")}}function B(t,e,i){return t>i.x&&t<i.x+i.width&&e>i.y&&e<i.y+i.height}class U{constructor(t,e){this.ide=t,this.row_el=e,this.insertion_col=0,this.selection_range=null,this._tokens=[],this._raw="",this.row_el.classList.add("yasl-editor-row")}get tokens(){return this._tokens}set tokens(t){this._tokens=t}get raw(){return this._raw}render(){const t=this.raw,e=new I(t).getTokens();let i="";if(e.length>0)for(const s of e){if(s.type===r.EOF)break;i+=`<span class='${R(s.type)}'>${t.slice(s.start,s.end)}</span>`}else i=t;this.row_el.innerHTML=i,this._tokens=e}goToStart(){const t=T.countLeadingWhitespaces(this.raw);this.ide.caret_manager.setColumn(t)}goToEnd(){const t=T.countTrailingWhitespaces(this.raw);this.ide.caret_manager.setColumn(this.raw.length-t)}appendChar(t){this.insertion_col===this.raw.length?this._raw+=t:this.insertion_col<this.raw.length&&(this._raw=this.raw.slice(0,this.insertion_col)+t+this.raw.slice(this.insertion_col)),this.ide.caret_manager.moveCol(t.length),this.render()}clear(){this._raw=""}getRowHeight(){return this.row_el.offsetHeight}activate(){this.row_el.classList.add("active")}deactivate(){this.row_el.classList.remove("active")}setHeight(t){this.row_el.style.height=t+"px"}getDomNode(){return this.row_el}setColumn(t){this.insertion_col=t}backspaceChar(){0!=this._raw.length?0!=this.insertion_col&&(this.selection_range?this.clearSelection():this.raw.slice(0,this.insertion_col).match(/^\s*$/)?(this._raw=this.raw.slice(this.insertion_col,this.raw.length),this.ide.caret_manager.setColumn(0)):(this._raw=this.raw.slice(0,this.insertion_col-1)+this.raw.slice(this.insertion_col,this.raw.length),this.ide.caret_manager.moveCol(-1)),this.render()):this.ide.deleteActiveRow()}deleteChar(){if(this.selection_range)this.clearSelection();else{if(!(this._raw.length>0&&this.insertion_col<this.raw.length))return;this._raw=this._raw.slice(0,this.insertion_col)+this.raw.slice(this.insertion_col+1,this.raw.length)}this.render()}selectWord(t,e){var i;this.selection_range&&(null===(i=window.getSelection())||void 0===i||i.removeRange(this.selection_range)),this.row_el.getBoundingClientRect();for(const i of this.row_el.children){const s=i.getBoundingClientRect();if(B(t,e,s)){const t=s.x,e=s.x+s.width,i=this.ide.getColumnFromPoint(t),n=this.ide.getColumnFromPoint(e);this.ide.selection.setAnchor(i,this.ide.active_row_index),this.ide.selection.moveHead(n,this.ide.active_row_index);break}}}selectRow(){this.ide.selection.setAnchor(0,this.ide.active_row_index),this.ide.selection.moveHead(this.raw.length,this.ide.active_row_index)}setText(t){this._raw=t,this.render()}clearSelection(){if(!this.selection_range)return;const t=this.selection_range.toString().length,e=this.insertion_col-t,i=this.insertion_col;this._raw=this.raw.slice(0,e)+this.raw.slice(i,this.raw.length),this.ide.caret_manager.moveCol(-t),this.selection_range=null}}class F{constructor(t,e){this.ide=e,this.anchor={line:0,col:0},this.head={line:0,col:0},this.anchor_el=document.createElement("div"),this.middle_el=document.createElement("div"),this.head_el=document.createElement("div"),t.append(this.anchor_el,this.middle_el,this.head_el),this.anchor_el.classList.add("yasl-ide-selection-el"),this.middle_el.classList.add("yasl-ide-selection-el"),this.head_el.classList.add("yasl-ide-selection-el")}moveHead(t,e){this.head.line=e,this.head.col=t,this.render()}setAnchor(t,e){this.clear();const i=this.ide.getMaxColumn(e);this.anchor.col=Math.min(t,i),this.anchor.line=e}clear(){this.head.col=0,this.head.line=0,this.anchor.col=0,this.anchor.line=0,this.anchor_el.style="",this.middle_el.style="",this.head_el.style=""}render(){if(this.head.col===this.anchor.col&&this.head.line===this.anchor.line)return this.anchor_el.style="",this.middle_el.style="",void(this.head_el.style="");const t=this.ide.caret_manager.char_width,e=this.ide.caret_manager.line_height,i=this.ide.rect.width;if(this.anchor_el.style.height=e+"px",this.anchor_el.style.top=this.anchor.line*e+"px",this.head.line===this.anchor.line){let e,i;this.head.col>this.anchor.col?(e=this.anchor.col,i=this.head.col):(e=this.head.col,i=this.anchor.col);const s=i-e;return this.anchor_el.style.left=e*t+"px",this.anchor_el.style.width=s*t+"px",this.ide.active_row_index=this.head.line,void this.ide.caret_manager.setColumn(this.head.col)}let s;this.anchor.line<this.head.line?(this.anchor_el.style.width=i+"px",this.anchor_el.style.left=this.anchor.col*t+"px",s=this.anchor.line):(this.anchor_el.style.width=this.anchor.col*t+"px",this.anchor_el.style.left="0",s=this.head.line);const n=Math.abs(this.head.line-this.anchor.line)-1;0!==n?(this.middle_el.style.left="0",this.middle_el.style.top=(s+1)*e+"px",this.middle_el.style.width=i+"px",this.middle_el.style.height=n*e+"px"):this.middle_el.style="",this.head_el.style.top=this.head.line*e+"px",this.head_el.style.left="0",this.head_el.style.width=this.head.col*t+"px",this.head_el.style.height=e+"px"}}class z{constructor(t){this.tab_spaces_count=4,this.rect=new DOMRect,this.editor_rows=[],this.editor_el=document.createElement("div"),this.selection=new F(this.editor_el,this),this.is_mouse_down=!1,this.row_height=10,this.char_width=10,this._active_row_index=0,t.append(this.editor_el),this.editor_el.tabIndex=0,this.editor_el.classList.add("yasl-editor");const e=document.createElement("div");e.classList.add("yasl-ide-loader"),e.innerText="loading",this.editor_el.appendChild(e),this.editor_el.onmousedown=t=>{var e,i;switch(t.detail){case 1:const s=this.getColumnFromPoint(t.clientX),n=this.getRowFromPoint(t.clientY);this.active_row_index=n,this.caret_manager.setColumn(s),this.selection.setAnchor(s,n),this.is_mouse_down=!0;break;case 2:null===(e=this.editor_rows[this.active_row_index])||void 0===e||e.selectWord(t.clientX,t.clientY);break;default:null===(i=this.editor_rows[this.active_row_index])||void 0===i||i.selectRow()}this.editor_el.focus(),t.preventDefault()},this.initialize().then(()=>{this.editor_el.classList.add("ready")}),this.editor_el.onkeydown=t=>{this.handleKeyPress(t.key)},window.addEventListener("mouseup",()=>{this.is_mouse_down=!1}),window.addEventListener("mousemove",t=>{if(!this.is_mouse_down)return;const e=this.getColumnFromPoint(t.clientX),i=this.getRowFromPoint(t.clientY);this.selection.moveHead(e,i),this.active_row_index=i,this.caret_manager.setColumn(e)}),this.caret_manager=new P(this.editor_el,this.editor_rows[this.active_row_index])}get active_row_index(){return this._active_row_index}set active_row_index(t){const e=this.editor_rows[this.active_row_index],i=b.clamp(t,0,this.editor_rows.length-1),s=this.editor_rows[i];e.deactivate(),s.activate(),this.caret_manager.setRow(s),this._active_row_index=i}handleKeyPress(t){const e=this.editor_rows[this.active_row_index];switch(t){case s.Backspace:e.backspaceChar();break;case s.Delete:e.deleteChar();break;case s.Home:e.goToStart();break;case s.End:e.goToEnd();break;case s.Enter:this.insertRowAfterCurrent(),this.moveDown();break;case s.ARROW_LEFT:this.caret_manager.moveCol(-1);break;case s.ARROW_RIGHT:this.caret_manager.moveCol(1);break;case s.ARROW_DOWN:this.moveDown();break;case s.ARROW_UP:this.moveUp();break;case s.Tab:this.tab_spaces_count>0?e.appendChar(" ".repeat(this.tab_spaces_count)):e.appendChar("\t");break;default:!function(t){return 1===t.length&&t.match(/[\p{L}\p{N}\p{P}\p{S}\p{Z}]/u)}(t)?console.log("unknown key handing over to IDE:",t):e.appendChar(t)}}updateIdeRect(){const t=this.editor_el.getBoundingClientRect();this.rect.height=t.height,this.rect.width=t.width,this.rect.x=t.x,this.rect.y=t.y,console.log("Updated to ",this.rect)}insertRowAfter(t){const e=this.editor_rows[t].getDomNode(),i=document.createElement("div"),s=new U(this,i);s.setHeight(this.row_height),this.editor_rows.splice(t+1,0,s),e.insertAdjacentElement("afterend",i),this.updateIdeRect()}insertRowAfterCurrent(){this.insertRowAfter(this.active_row_index)}moveUp(){this.active_row_index--}moveDown(){this.active_row_index++}deleteActiveRow(){if(0===this.active_row_index)return;const t=this.editor_rows[this.active_row_index];this.editor_rows.splice(this.active_row_index,1),this.editor_el.removeChild(t.getDomNode()),this.active_row_index--;const e=this.editor_rows[this.active_row_index];this.caret_manager.setColumn(e.raw.length),this.updateIdeRect()}getMaxColumn(t){return t>=this.editor_rows.length?0:this.editor_rows[t].raw.length}getTotalRows(){return this.editor_rows.length-1}getColumnFromPoint(t){return b.clamp(Math.round((t-this.rect.x)/this.char_width),0,this.getMaxColumn(this.active_row_index))}getRowFromPoint(t){return b.clamp(Math.round((t-this.rect.y)/this.row_height),0,this.getTotalRows())}pasteString(t){let e="",i=0;for(const s of t)"\n"!==s?e+=s:(i>=this.editor_rows.length&&(this.insertRowAfter(this.editor_rows.length-1),this.moveDown()),this.editor_rows[i].setText(e),console.log("wrote",e,"to",i),e="",i++);e.length>0&&(this.insertRowAfterCurrent(),this.moveDown(),this.editor_rows[i].setText(e),e=""),this.editor_rows[this.active_row_index].goToEnd()}initialize(){return t=this,e=void 0,s=function*(){yield document.fonts.ready;const t=window.getComputedStyle(this.editor_el),e=`${t.fontSize} ${t.fontFamily}`;yield document.fonts.load(e),yield new Promise(requestAnimationFrame);const i=function(t){const e=document.createElement("span");e.textContent="MWXgyjq",e.style.visibility="hidden",e.style.position="absolute",e.style.whiteSpace="pre";const i=window.getComputedStyle(t);e.style.font=i.font,e.style.fontSize=i.fontSize,e.style.fontFamily=i.fontFamily,e.style.letterSpacing=i.letterSpacing,e.style.fontWeight=i.fontWeight,e.style.lineHeight=i.lineHeight,document.body.appendChild(e);const s=e.getBoundingClientRect();return document.body.removeChild(e),console.log("Calculating font metrics for",e.style.fontFamily),{width:s.width/7,height:s.height}}(this.editor_el),s=i.height;for(const t of this.editor_rows)t.setHeight(s);this.caret_manager.setFontMetrics(i.width,i.height),this.row_height=s,this.char_width=i.width;const n=document.createElement("div"),a=new U(this,n);a.setHeight(this.row_height),this.editor_rows.push(a),this.editor_el.appendChild(n),this.updateIdeRect(),this.pasteString("'hellooooooooooooo'\n'worlllllllllldd!',\n'yasl'")},new((i=void 0)||(i=Promise))(function(n,a){function o(t){try{h(s.next(t))}catch(t){a(t)}}function r(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,r)}h((s=s.apply(t,e||[])).next())});var t,e,i,s}}var H=i(805),q={};q.styleTagTransform=N(),q.setAttributes=w(),q.insert=g().bind(null,"head"),q.domAPI=_(),q.insertStyleElement=v(),u()(H.A,q),H.A&&H.A.locals&&H.A.locals;class W{constructor(){this.parent=document.createElement("div"),this.parent.id="yasl-keyboard",document.body.appendChild(this.parent);const t=document.createElement("div");t.classList.add("icon"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M4 19q-.825 0-1.412-.587T2 17V7q0-.825.588-1.412T4 5h16q.825 0 1.413.588T22 7v10q0 .825-.587 1.413T20 19zm0-2h16V7H4zm4-1h8v-2H8zm-3-3h2v-2H5zm3 0h2v-2H8zm3 0h2v-2h-2zm3 0h2v-2h-2zm3 0h2v-2h-2zM5 10h2V8H5zm3 0h2V8H8zm3 0h2V8h-2zm3 0h2V8h-2zm3 0h2V8h-2zM4 17V7z"/></svg>',this.parent.append(t)}static getInstance(){return W.instance||(W.instance=new W),W.instance}open(){this.parent.classList.add("open")}close(){this.parent.classList.remove("open")}}W.instance=null;var G,$,Y,X=i(705),V={};V.styleTagTransform=N(),V.setAttributes=w(),V.insert=g().bind(null,"head"),V.domAPI=_(),V.insertStyleElement=v(),u()(X.A,V),X.A&&X.A.locals&&X.A.locals,function(t){t[t.NORMAL=0]="NORMAL",t[t.ERROR=1]="ERROR",t[t.WARNING=2]="WARNING"}(G||(G={})),"ontouchstart"in window&&navigator.maxTouchPoints>0&&W.getInstance();class j{constructor(t){this.repl_input_container=document.createElement("div"),this.repl_output_container=document.createElement("div"),this.runtime=new O,this.repl_output_container.classList.add("yasl-repl-output"),this.repl_input_container.classList.add("yasl-repl-input"),this.yasl_editor=new z(this.repl_input_container);const e=document.createElement("div");e.classList.add("yasl-repl-container"),e.append(this.repl_input_container,this.repl_output_container),t.append(e)}}class K{constructor(...t){if("string"==typeof t[0]){this.hex=t[0];const{r:e,g:i,b:s,a:n}=K.hexToRgba(this.hex);this.r=e,this.g=i,this.b=s,this.a=n}else{const[e=0,i=0,s=0,n=1]=t;this.r=e,this.g=b.clamp(i,0,255),this.b=b.clamp(s,0,255),this.a=b.clamp(n,0,255),this.hex=K.getHex(e,i,s,n)}}static hexToRgba(t){if(t=t.replace(/^#/,""),![3,4,6,8].includes(t.length))throw new Error("Invalid hex color code"+t+". Must be 3, 4, 6, or 8 digits. but was"+t);3!==t.length&&4!==t.length||(t=t.split("").map(t=>t+t).join(""));let e,i,s,n=1;return 6===t.length?(e=parseInt(t.slice(0,2),16),i=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16)):(e=parseInt(t.slice(0,2),16),i=parseInt(t.slice(2,4),16),s=parseInt(t.slice(4,6),16),n=parseInt(t.slice(6,8),16)/255),n=Math.round(100*n)/100,{r:e,g:i,b:s,a:n}}static getHex(t,e,i,s){return`#${t.toString(16).padStart(2,"0")}${e.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${s?Math.round(255*s).toString(16).padStart(2,"0"):""}`}toString(){return 1===this.a?`rgb(${this.r}, ${this.g}, ${this.b})`:`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a.toFixed(2)})`}}function Q(t,e,i,s){return t===e?e:t+(e-t)*s(i)}class Z{static linear(t){return t}static easeInSin(t){return 1-Math.cos(t*Math.PI/2)}static easeOutSin(t){return Math.sin(t*Math.PI/2)}static easeInOutSin(t){return(1-Math.cos(t*Math.PI))/2}static easeInCubic(t){return Math.pow(t,3)}static easeOutCubic(t){return 1-Math.pow(1-t,3)}static easeInOutCubic(t){return t<.5?4*Math.pow(t,3):1-Math.pow(1-t,3)}static easeInQuad(t){return t*t}static easeOutQuad(t){return 1-Math.pow(1-t,2)}static easeInOutQuad(t){return t<.5?2*Math.pow(t,2):1-Math.pow(1-t,2)}}class J{constructor(t,e,i){this.total_duration_ms=e,this.duration_passed_ms=0,this.easing=i,this.drawable=t}getId(){return this.drawable?this.constructor.name+this.drawable.id:this.constructor.name}}class tt extends J{constructor(t,e,i,s=250,n=Z.easeInSin){super(t,s,n),this.from=e,this.to=i,this.drawable.is_color_animating=!0}finalize(){this.setNormalizedTime(1),this.drawable.is_color_animating=!1,this.drawable.color=this.to,this.interrupt()}interrupt(){this.drawable.is_color_animating=!1}setNormalizedTime(t){const e=b.roundedClamp(Q(this.from.r,this.to.r,t,this.easing),0,255),i=b.roundedClamp(Q(this.from.g,this.to.g,t,this.easing),0,255),s=b.roundedClamp(Q(this.from.b,this.to.b,t,this.easing),0,255),n=b.roundedClamp(Q(this.from.a,this.to.a,t,this.easing),0,255);this.drawable.color=new K(e,i,s,n)}}class et extends J{constructor(t,e,i,s=250,n=Z.easeInSin){super(null,s,n),this.callback=t,this.from=e,this.to=i}finalize(){this.setNormalizedTime(1)}interrupt(){}setNormalizedTime(t){this.callback(Q(this.from,this.to,t,this.easing),1===t)}}class it{constructor(){this.animations_map=new Map}add(t){var e;const i=t.getId();this.animations_map.has(i)&&(null===(e=this.animations_map.get(i))||void 0===e||e.interrupt()),this.animations_map.set(i,t)}step(t){for(const[e,i]of this.animations_map){if(i.duration_passed_ms+=t,i.duration_passed_ms>i.total_duration_ms){i.duration_passed_ms=i.total_duration_ms,i.finalize(),this.animations_map.delete(e);break}const s=i.duration_passed_ms/i.total_duration_ms;i.setNormalizedTime(s)}}}!function(t){t[t.LIGHT=0]="LIGHT",t[t.DARK=1]="DARK",t[t.AUTO=2]="AUTO"}($||($={})),function(t){t.DEFAULT="default",t.HIGHLIGHTED="highlighted",t.SELECTED="selected",t.HOVER="hover",t.ON_BACKGROUND="on-background",t.ON_PRIMARY="on-primary",t.ON_SECONDARY="on-secondary",t.BORDER="border"}(Y||(Y={}));const st=function(){const t="theme";let e=!1,i=!1,s=getComputedStyle(document.documentElement);function n(){s=getComputedStyle(document.documentElement)}return{setThemeType:a=>{switch(s=getComputedStyle(document.documentElement),e=!1,a){case $.LIGHT:document.documentElement.setAttribute(t,"light");break;case $.DARK:document.documentElement.setAttribute(t,"dark");break;case $.AUTO:!function(){if(window.matchMedia){const s=window.matchMedia("(prefers-color-scheme: dark)");if(e=!0,s.matches?document.documentElement.setAttribute(t,"dark"):document.documentElement.setAttribute(t,"light"),i)return;s.addEventListener("change",s=>{i=!0,e&&(n(),s.matches?document.documentElement.setAttribute(t,"dark"):document.documentElement.setAttribute(t,"light"))})}else document.documentElement.setAttribute(t,"light")}()}n()},getBgColor(t,e=Y.DEFAULT){const i=`--${t}-bg-${e}-color`,n=s.getPropertyValue(i);return""===n&&console.error(i," is not defined."),new K(n)},getFgColor(t,e=Y.DEFAULT){const i=`--${t}-fg-${e}-color`,n=s.getPropertyValue(i);return""===n&&console.error(i," is not defined."),new K(n)},getTextColor(t=Y.ON_BACKGROUND){const e=`--text-${t}-color`,i=s.getPropertyValue(e);return""===i&&console.error(e," is not defined."),new K(i)},getColor(t){const e=`--${t}-color`,i=s.getPropertyValue(e);return""===i&&console.error(e,"is not defined."),new K(i)}}}();class nt{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new nt(this.x,this.y)}length_sqrd(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.length_sqrd())}set(t,e){return this.x=t,this.y=e,this}add(t){return new nt(this.x+t.x,this.y+t.y)}addXY(t,e){return new nt(this.x+t,this.y+e)}add_self(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return new nt(this.x-t.x,this.y-t.y)}subXY(t,e){return new nt(this.x-t,this.y-e)}sub_self(t){return this.x-=t.x,this.y-=t.y,this}scale(t,e){return e||(e=t),new nt(this.x*t,this.y*e)}scale_self(t,e){return e||(e=t),this.x*=t,this.y*=t,this}dot(t){return this.x*t.x+this.y*t.y}toString(){return this.x+"i + "+this.y+"j"}}nt.unit_x=Object.freeze(new nt(1,0)),nt.unit_y=Object.freeze(new nt(0,1)),nt.ZERO=Object.freeze(new nt(0,0));class at{constructor(t,e){this.width=t,this.height=e}scale(t){return new at(this.width*t,this.height*t)}scale_self(t){return this.width*=t,this.height*=t,this}max(){return Math.max(this.width,this.height)}toString(){return this.width+"x"+this.height}set(t,e){this.width=t,this.height=e}copy(){return new at(this.width,this.height)}}at.ZERO=Object.freeze(new at(0,0));class ot{constructor(t,e,i){this.scene=t,this.class_name=i,this.pos=new nt(0,0),this.is_color_animating=!1,this.color=new K("#f00"),this.ctx=t.ctx,this.id=e,this.color_state=Y.DEFAULT}highlight(){this.scene.animator.add(new tt(this,this.color,st.getBgColor(this.getName(),Y.HIGHLIGHTED))),this.color_state=Y.HIGHLIGHTED}getName(){return this.class_name.toLowerCase()}update(t){this.is_color_animating||(this.color=st.getBgColor(this.getName(),this.color_state))}drawPointVec(t,e="green"){const i=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));i>1&&this.drawArrow(100*t.x/i,100*t.y/i,e)}drawArrow(t,e,i="green"){if(0===t&&0===e)return;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=5,this.ctx.lineCap="round",this.ctx.strokeStyle=i,this.ctx.moveTo(this.pos.x,this.pos.y);const s=this.pos.add(new nt(t,e));this.ctx.lineTo(s.x,s.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawCircle(t,e,i,s,n=!1,a,o=1){if(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,i,t,0,2*Math.PI),this.ctx.fillStyle=s,n){let t=this.ctx.strokeStyle;this.ctx.lineWidth=o,this.ctx.strokeStyle=a,this.ctx.strokeStyle=t,this.ctx.stroke()}this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()}reset(){console.error("Reset not implemented for",this.constructor.name)}drawLine(t,e,i,s,n,a){this.ctx.save(),this.ctx.strokeStyle=a,this.ctx.lineWidth=n,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()}drawText(t,e,i,s,n=1){this.ctx.save(),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.font=`${n}em Arial`,this.ctx.fillStyle=s,this.ctx.fillText(t,e,i),this.ctx.restore()}drawRect(t,e,i,s,n="#000",a,o=0,r){this.ctx.save(),this.ctx.fillStyle=n,o>0&&(this.ctx.strokeStyle=a),this.ctx.beginPath(),this.ctx.roundRect(300,5,200,100,r),this.ctx.closePath(),this.ctx.restore()}}class rt extends ot{constructor(t,e,i){super(t,rt.getEdgeKey(e.id,i.id),"edge"),this.start_node=e,this.end_node=i}static getEdgeKey(t,e){return[t,e].sort().join()}render(){this.drawLine(this.start_node.pos.x,this.start_node.pos.y,this.end_node.pos.x,this.end_node.pos.y,rt.thickness,this.color.hex)}}function ht(t,e){const i=document.createElement("div");switch(e){case"info":i.style.backgroundColor="rgba(0,140,255,0.18)";break;case"warn":i.style.backgroundColor="rgba(255,241,0,0.18)";break;case"error":i.style.backgroundColor="rgba(255,0,0,0.18)";break;case"success":i.style.backgroundColor="rgba(55,255,0,0.18)";break;default:i.style.backgroundColor="rgba(0,0,0,0.18)"}return Object.assign(i.style,{minWidth:"100%",borderRadius:"8px",fontFamily:"sans-serif",width:"fit-content",justifyContent:"space-between",padding:"0.5em"}),i.innerText=`[${e}]\t\t\t${t}`,i}rt.thickness=3;class ct{constructor(t,e){const i=document.createElement("div"),s=document.createElement("div");s.innerText=t,this.value_el=document.createElement("div"),i.append(s,this.value_el),Object.assign(i.style,{minWidth:"100%",display:"flex",borderRadius:"8px",backgroundColor:"rgba(255,255,255,0.04)",fontFamily:"sans-serif",width:"fit-content",justifyContent:"space-between",padding:"0.1em"}),Object.assign(s.style,{fontWeight:"bold",color:"#ececec",padding:"0.5em",minWidth:"max-content"}),Object.assign(this.value_el.style,{color:"#ffffff",padding:"0.5em",alignContent:"right"}),e.append(i)}set(t){this.value_el.innerText=t}}class lt{constructor(t,e){this.center=t,this.half_dimension=e}static fromRect(t,e,i,s){return new lt(new nt(t+i/2,e+s/2),new at(i/2,s/2))}update(t,e){this.center=t,this.half_dimension=e}updateRect(t,e,i,s){this.center.set(t+i/2,e+s/2),this.half_dimension.set(i/2,s/2)}containsPoint(t){return Math.abs(t.x-this.center.x)<=this.half_dimension.width&&Math.abs(t.y-this.center.y)<=this.half_dimension.height}intersectsAABB(t){return this.center.x-t.center.x<=this.half_dimension.width+t.half_dimension.width&&this.center.y-t.center.y<=this.half_dimension.height+t.half_dimension.height}toString(){return`${this.center} ${this.half_dimension}`}copy(){return new lt(this.center.copy(),this.half_dimension.copy())}}class dt{constructor(t,e,i=10){this.id=t,this.point=e,this.mass=i}}setInterval(()=>{var t;ut.ACCURACY=null===(t=document.getElementById("accuracy-slider"))||void 0===t?void 0:t.valueAsNumber},100);class ut{constructor(t){this.mass=0,this.regions=[],this.has_sub_divisions=!1,this.region_name="",this.boundary=t,this.has_sub_divisions=!1}subdivide(){const t=this.boundary.half_dimension,e=this.boundary.center,i=new ut(new lt(new nt(e.x+t.width/2,e.y-t.height/2),this.boundary.half_dimension.scale(.5))),s=new ut(new lt(new nt(e.x-t.width/2,e.y-t.height/2),this.boundary.half_dimension.scale(.5))),n=new ut(new lt(new nt(e.x-t.width/2,e.y+t.height/2),this.boundary.half_dimension.scale(.5))),a=new ut(new lt(new nt(e.x+t.width/2,e.y+t.height/2),this.boundary.half_dimension.scale(.5)));this.regions.push(i,s,n,a),this.has_sub_divisions=!0}contains(t){return this.boundary.containsPoint(t)}insert(t){var e,i;if(!this.boundary.containsPoint(t.point))return!1;if(!this.node&&!this.has_sub_divisions)return this.node=t,this.COM=t.point.copy(),this.mass=t.mass,!0;this.has_sub_divisions||this.subdivide(),this.region_name="";let s=!1;for(const t of this.regions)!s&&this.node&&t.insert(this.node)&&(s=!0,this.node=void 0),this.region_name+=null!==(i=null===(e=t.node)||void 0===e?void 0:e.id)&&void 0!==i?i:"";let n=!1;for(const e of this.regions)if(e.insert(t)){n=!0;break}if(n){const e=this.mass+t.mass;if(!this.COM)return!0;this.COM.scale_self(this.mass).add_self(t.point.scale(t.mass)).scale_self(1/e),this.mass=e}return n}getTotalForcesOnPoint(t,e){if(0===this.regions.length)return new nt(0,0);const i=new nt(0,0),s=this.getNodesInCircularRange(t.point,ut.FULL_ACCURACY_CIRCLE_RADIUS);for(const n of s)t.id!=n.id&&i.add_self(e(t,n));return i.add_self(this.getForceDueToRegions(t,e,s)),i}getForceDueToRegions(t,e,i=[],s=0){const n=new nt(0,0),a=1-ut.ACCURACY;for(const o of this.regions){if(!o.COM||0===o.mass)continue;const r=o.COM.x-t.point.x,h=o.COM.y-t.point.y;let c=r*r+h*h;if(o.boundary.half_dimension.width/Math.sqrt(c)>=a&&o.has_sub_divisions)n.add_self(o.getForceDueToRegions(t,e,i,s+1));else{if(Math.abs(r)<1e-6&&Math.abs(h)<1e-6)continue;const i=new dt(o.region_name,o.COM,o.mass);n.add_self(e(t,i))}}return n}getNodesInRange(t){const e=[];if(!this.boundary.intersectsAABB(t))return e;if(!this.has_sub_divisions)return this.node&&t.containsPoint(this.node.point)&&e.push(this.node),e;for(const i of this.regions)e.push(...i.getNodesInRange(t));return e}getNodesInCircularRange(t,e){const i=[];if(!function(t,e,i){const s=i.center.x-i.half_dimension.width,n=i.center.x+i.half_dimension.width,a=i.center.y-i.half_dimension.height,o=i.center.y+i.half_dimension.height,r=Math.max(s,Math.min(t.x,n)),h=Math.max(a,Math.min(t.y,o)),c=t.x-r,l=t.y-h;return c*c+l*l<=e*e}(t,e,this.boundary))return i;if(!this.has_sub_divisions)return this.node&&function(t,e,i){const s=t.x-i.x,n=t.y-i.y;return s*s+n*n<=e*e}(t,e,this.node.point)&&i.push(this.node),i;for(const s of this.regions)i.push(...s.getNodesInCircularRange(t,e));return i}*getAllRegions(){if(yield this,this.has_sub_divisions)for(const t of this.regions)yield*t.getAllRegions()}toString(){}}ut.ACCURACY=.9,ut.FULL_ACCURACY_AREA=new at(100,100),ut.FULL_ACCURACY_CIRCLE_RADIUS=100;class mt extends ot{constructor(t,e,i,s,n=""){super(t,e,"node"),this.attr_force=new nt(0),this.repln_force=new nt(0),this.alpha=1,this.position_change=new nt(0,0),this.velocity=new nt(0),this.force=new nt(0),this.max_velocity=100,this.velocity_decay=.5,this.min_velocity=1,this.pos.set(i.x,i.y),this.text=n,this.radius=s,this.mass=1,this.quad_tree_node=new dt(e,this.pos,100)}update(t){super.update(20);const e=.02;this.force.x=this.attr_force.x+this.repln_force.x,this.force.y=this.attr_force.y+this.repln_force.y,this.force.scale_self(this.alpha);let i=b.clamp(this.force.x*e,-this.max_velocity,this.max_velocity),s=b.clamp(this.force.y*e,-this.max_velocity,this.max_velocity);this.velocity.x+=i,this.velocity.y+=s,this.velocity.scale_self(1-this.velocity_decay),Math.abs(this.velocity.x)<this.min_velocity&&(this.velocity.x=0),Math.abs(this.velocity.y)<this.min_velocity&&(this.velocity.y=0);const n=this.velocity.x*e,a=this.velocity.y*e;this.pos.x+=n,this.pos.y+=a,this.position_change.set(n,a),this.alpha-=this.alpha*mt.alphaDecay,this.alpha<.001&&(this.alpha=0),this.repln_force.set(0,0),this.attr_force.set(0,0)}render(){this.drawCircle(this.radius,this.pos.x,this.pos.y,this.color.hex,!0,st.getBgColor(this.getName(),Y.BORDER).hex,1),this.drawText(this.id,this.pos.x,this.pos.y,st.getTextColor(Y.ON_PRIMARY).hex)}getDistanceFromPoint(t){const e=this.pos.subtract(t).length_sqrd();return Math.sqrt(e)}containsPoint(t,e){const i=this.pos,s=new nt(t,e).sub_self(i).length_sqrd();return Math.pow(this.radius,2)>s}}mt.alphaDecay=.0016;const _t=!1;var pt;!function(t){t[t.Primary=0]="Primary",t[t.Auxiliary=1]="Auxiliary",t[t.Secondary=2]="Secondary"}(pt||(pt={}));class gt{constructor(t){this.location=new nt,this.buttonsPressed=new Set,this.touches=[],this.isTouching=!1,this.onMouseMove=t=>{const e=this.element.getBoundingClientRect();this.location=new nt(t.clientX-e.x,t.clientY-e.y)},this.onMouseDown=t=>{t.target===this.element&&this.buttonsPressed.add(t.button)},this.onMouseUp=t=>{this.buttonsPressed.delete(t.button)},this.onTouchStart=t=>{if(t.target!==this.element)return;const e=this.element.getBoundingClientRect();this.isTouching=!0,this.touches=Array.from(t.touches).map(t=>new nt(t.clientX-e.x,t.clientY-e.y)),this.location=this.touches[0]},this.onTouchMove=t=>{const e=this.element.getBoundingClientRect();this.touches=Array.from(t.touches).map(t=>new nt(t.clientX-e.x,t.clientY-e.y)),this.location=this.touches[0]},this.onTouchEnd=t=>{const e=this.element.getBoundingClientRect();this.touches=Array.from(t.touches).map(t=>new nt(t.clientX-e.x,t.clientY-e.y)),this.isTouching=this.touches.length>0,this.touches.length>0&&(this.location=this.touches[0])},this.element=t,window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchstart",this.onTouchStart,{passive:_t}),window.addEventListener("touchmove",this.onTouchMove,{passive:_t}),window.addEventListener("touchend",this.onTouchEnd),window.addEventListener("touchcancel",this.onTouchEnd)}isButtonDown(t){return this.buttonsPressed.has(t)}dispose(){window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),window.removeEventListener("touchcancel",this.onTouchEnd)}}const ft=Object.freeze({x:0,y:0}),wt=new class{constructor(t){this.reactive_logger_map=new Map,this.container_el=document.createElement("div"),this.reactive_logger_container=document.createElement("div"),this.container_el.id=t;const e=document.createElement("h2");e.style.textAlign="center",e.style.padding="0.5em",e.innerText=t,Object.assign(this.container_el.style,{display:"flex",flexDirection:"column",width:"300px",minWidth:"50",maxWidth:"100vw",padding:"0.5em",overflow:"scroll",border:"1px solid #333",borderRadius:"8px",backgroundColor:"#000000",boxShadow:"0 0 40px rgba(0, 0, 0, 0.8)",fontFamily:"sans-serif",maxHeight:"90vh",minHeight:"50px",height:"fit-content",position:"fixed",top:"1em",left:"50%",resize:"both",scrollingBehavior:"none"}),this.container_el.classList.add("draggable"),document.body.append(this.container_el),this.container_el.append(e,this.reactive_logger_container)}setVisible(t){this.container_el.style.display=t?"flex":"none"}info(t){this.container_el.appendChild(ht(t,"info"))}warn(t){this.container_el.appendChild(ht(t,"warn"))}error(t){this.container_el.appendChild(ht(t,"error"))}getReactiveLog(t){let e=this.reactive_logger_map.get(t);return e||(e=new ct(t,this.reactive_logger_container),this.reactive_logger_map.set(t,e)),e}success(t){this.container_el.appendChild(ht(t,"success"))}}("scene-logger");wt.setVisible(!1);class yt{constructor(t,e){this.func=t,this.wait_ms=e,this.lastCall=0,this.lastCall=-e}call(...t){const e=Date.now();e-this.lastCall>=this.wait_ms&&(this.lastCall=e,this.func(...t))}}class vt{constructor(){this.camera_updated=!0,this.onupdate=null,this._x=0,this._y=0,this._zoom=1}get x(){return this._x}set x(t){this._x=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}get y(){return this._y}set y(t){this._y=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this.camera_updated=!0,this.onupdate&&this.onupdate()}}class xt{constructor(t,e=!1){this.ctx=t,this.show_fps=e,this.animator=new it,this.camera=new vt,this.target_frame_rate=60,this.nodes=new Map,this.edges=new Map,this.accumulated_alpha=0,this.accumulated_frame_time=0,this.accumulated_node_position_change=-1,this.fps=0,this.last_animation_call_time=0,this.drawable_selected=null,this.grid_size=new at(100,100),this.prev_mouse_pos=new nt,this.fps_counter=0,this.boundary_bounds=lt.fromRect(0,0,0,0),this.required_half_size=new at(0,0),this.offset=new nt(0),this.dragging_camera=!1,this.is_zooming=!1,this.initial_touches=null,this.pinching_to_zoom=!1,this.repaint_drawables=!1,this.bounds_updated=!1,this.last_draw_image=null,this.is_loop_running=!1,this.viewport=lt.fromRect(0,0,0,0),this.ctx.scale(devicePixelRatio,devicePixelRatio),this.show_fps=e,this.is_running=!1,this.debug_box_el=document.getElementById("debug-box"),this.debug_box_el.checked=!1,this.mouse_info=new gt(this.ctx.canvas),this.camera.onupdate=()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)},this.debounceSelectedNodeAlphaReset=new yt((...t)=>{for(const e of t){if(!e||!this.force_quad_tree)return;e.alpha<.5&&(e.alpha=.5);for(const t of this.force_quad_tree.getNodesInCircularRange(e.pos,300)){const e=this.nodes.get(t.id);e&&e.alpha<.5&&(e.alpha=.6)}}},100),new ResizeObserver(()=>{this.updateViewportFromScreen(this.ctx.canvas.width,this.ctx.canvas.height)}).observe(this.ctx.canvas),this.start_btn=document.getElementById("start-btn"),this.start_btn&&this.start_btn.addEventListener("click",()=>{this.is_running?this.stop():this.start()}),this.ctx.canvas.addEventListener("mousedown",t=>this.handleMousePressed(t)),this.ctx.canvas.addEventListener("touchstart",t=>{this.initial_touches=t.touches,1===t.touches.length?this.handleMousePressed(t):(t.preventDefault(),this.handleMultiTouch(t))},{passive:!1}),this.ctx.canvas.addEventListener("wheel",t=>{t.shiftKey&&this.zoomAt(t.clientX*devicePixelRatio,t.clientY*devicePixelRatio,t.deltaY<0)},{passive:!1}),window.addEventListener("mouseup",()=>this.handleMouseUp()),window.addEventListener("touchend",()=>{this.handleMouseUp(),this.pinching_to_zoom=!1}),window.addEventListener("mousemove",t=>this.handleMouseMove(t),{passive:!1}),window.addEventListener("touchmove",t=>{wt.getReactiveLog("Touch count").set(t.touches[0].identifier.toString()),1===t.touches.length?this.handleMouseMove(t):this.handleMultiTouchMove(t)},{passive:!1})}getTransformedPoint(t,e){return new nt(t/(this.camera.zoom*devicePixelRatio)+this.camera.x,e/(this.camera.zoom*devicePixelRatio)+this.camera.y)}loop(t){return e=this,i=void 0,n=function*(){const e=this.last_animation_call_time,i=t-this.last_animation_call_time;this.last_animation_call_time=t;let s=performance.now();this.is_running&&(this.update(i),this.animator.step(i));let n=performance.now();const a=n-s;s=performance.now(),this.render(),n=performance.now();const o=n-s;wt.getReactiveLog("Update Time(ms)").set(a.toString()),wt.getReactiveLog("Render Time(ms)").set(o.toString()),wt.getReactiveLog("FPS").set(this.fps.toString()),wt.getReactiveLog("Target FPS").set(this.target_frame_rate.toString()),wt.getReactiveLog("ZOOM").set(this.camera.zoom.toString()),wt.getReactiveLog("Camera").set(`${this.camera.x}i + ${this.camera.y}j`),wt.getReactiveLog("Accumulated Alpha").set(this.accumulated_alpha.toString()),wt.getReactiveLog("Nodes").set(this.nodes.size.toString()),wt.getReactiveLog("Edges").set(this.edges.size.toString()),wt.getReactiveLog("Bounds").set(this.boundary_bounds.half_dimension.toString());const r=t-e;this.accumulated_frame_time+=r,this.show_fps&&(this.accumulated_frame_time>=1e3?(this.accumulated_frame_time=0,this.fps=this.fps_counter,this.fps_counter=0):this.fps_counter+=1),requestAnimationFrame(t=>{this.loop(t)})},new((s=void 0)||(s=Promise))(function(t,a){function o(t){try{h(n.next(t))}catch(t){a(t)}}function r(t){try{h(n.throw(t))}catch(t){a(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s(function(t){t(i)})).then(o,r)}h((n=n.apply(e,i||[])).next())});var e,i,s,n}start(){this.is_running||(this.is_running=!0,this.last_animation_call_time=performance.now(),this.is_loop_running||this.loop(this.last_animation_call_time).then(()=>this.is_loop_running=!0),this.start_btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M14 19V5h4v14zm-8 0V5h4v14z"/></svg>')}stop(){this.render(),this.is_running=!1,this.accumulated_frame_time=0,this.fps=0,this.fps_counter=0,this.start_btn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M8 17.175V6.825q0-.425.3-.713t.7-.287q.125 0 .263.037t.262.113l8.15 5.175q.225.15.338.375t.112.475t-.112.475t-.338.375l-8.15 5.175q-.125.075-.262.113T9 18.175q-.4 0-.7-.288t-.3-.712"/></svg>'}render(){var t;const e=devicePixelRatio||1;if(this.ctx.setTransform(e*this.camera.zoom,0,0,e*this.camera.zoom,-this.camera.x*e*this.camera.zoom,-this.camera.y*e*this.camera.zoom),!this.camera.camera_updated&&!this.bounds_updated&&!this.repaint_drawables)if(this.last_draw_image){if(this.last_draw_image.complete){const t=this.getTransformedPoint(0,0),i=1/(this.camera.zoom*e);return this.ctx.drawImage(this.last_draw_image,t.x,t.y,this.ctx.canvas.width*i,this.ctx.canvas.height*i),void wt.getReactiveLog("Rendering").set("False")}}else this.ctx.canvas.toBlob(t=>{t&&(this.last_draw_image=new Image,this.last_draw_image.loading="eager",this.last_draw_image.src=URL.createObjectURL(t))},"image/png",1);wt.getReactiveLog("Rendering").set("True"),(this.camera.camera_updated||this.bounds_updated||this.repaint_drawables)&&(this.last_draw_image=null),this.camera.camera_updated=!1,this.repaint_drawables=!1;const i=this.ctx.canvas.width,s=this.ctx.canvas.height;this.ctx.save(),this.ctx.resetTransform(),this.ctx.fillStyle=st.getBgColor("canvas").hex,this.ctx.fillRect(0,0,i,s),this.ctx.beginPath();const n=-this.camera.x*this.camera.zoom*e%(this.grid_size.width*this.camera.zoom*e),a=-this.camera.y*this.camera.zoom*e%(this.grid_size.height*this.camera.zoom*e);this.ctx.strokeStyle=st.getColor("grid").hex,this.ctx.lineWidth=1;for(let t=n;t<i;t+=this.grid_size.width*this.camera.zoom*e)this.ctx.moveTo(t,0),this.ctx.lineTo(t,s);for(let t=a;t<s;t+=this.grid_size.height*this.camera.zoom*e)this.ctx.moveTo(0,t),this.ctx.lineTo(i,t);this.ctx.stroke(),this.ctx.restore(),this.ctx.save();const o=this.edges,r=this.nodes;for(const[,t]of o)(this.viewport.containsPoint(t.start_node.pos)||this.viewport.containsPoint(t.end_node.pos))&&t.render();for(const[,t]of r)this.viewport.containsPoint(t.pos)&&(null==t||t.render());if(this.force_quad_tree&&(null===(t=this.debug_box_el)||void 0===t?void 0:t.checked)){this.ctx.beginPath(),this.ctx.setLineDash([]),this.ctx.strokeStyle=st.getColor("debug").hex;let t=null;for(const e of this.force_quad_tree.getAllRegions())t=e.boundary,this.ctx.strokeRect(t.center.x-t.half_dimension.width,t.center.y-t.half_dimension.height,2*t.half_dimension.width,2*t.half_dimension.height),e.COM&&this.ctx.fillText(`${e.mass}`,e.COM.x,e.COM.y);t=this.viewport,this.ctx.strokeStyle="#00f",this.ctx.strokeRect(t.center.x-t.half_dimension.width,t.center.y-t.half_dimension.height,2*t.half_dimension.width,2*t.half_dimension.height),this.ctx.closePath()}this.ctx.restore()}update(t){this.accumulated_alpha<.001&&(this.accumulated_alpha=0);const e=new nt;let i=0;this.accumulated_alpha=0;for(const[,t]of this.nodes)this.accumulated_alpha+=t.alpha,e.add_self(t.pos.scale(t.mass)),i+=t.mass;if(e.scale_self(1/i),0!==this.accumulated_alpha||this.bounds_updated||this.camera.camera_updated){this.force_quad_tree=new ut(this.boundary_bounds);for(const[,t]of this.nodes)this.force_quad_tree.insert(t.quad_tree_node);wt.getReactiveLog("Building quadtree").set("True"),this.repaint_drawables=!0,this.bounds_updated=!1}else wt.getReactiveLog("Building quadtree").set("False");if(0!==this.accumulated_alpha){for(const[,e]of this.edges){e.update(t);const i=e.start_node,s=e.end_node,n=At(i,s);i.attr_force.x+=n.x,i.attr_force.y+=n.y,s.attr_force.x-=n.x,s.attr_force.y-=n.y}for(const[e,i]of this.nodes)if(this.drawable_selected!==i&&this.force_quad_tree.contains(i.pos)?this.force_quad_tree&&0!==this.accumulated_alpha&&(i.repln_force=this.force_quad_tree.getTotalForcesOnPoint(i.quad_tree_node,bt)):(i.repln_force.set(0,0),i.attr_force.set(0,0)),i.update(t),0===this.accumulated_frame_time){const t=document.getElementById(e);t&&(t.innerHTML=`<div>id: ${i.id}</div><div>alpha: ${i.alpha}</div><div> pos: ${this.getTransformedPoint(i.pos.x,i.pos.y)} </div><div>vel: ${Math.round(1e3*i.velocity.x)/1e3}i + ${Math.round(1e3*i.velocity.y)/1e3}</div><div>force: ${Math.round(1e3*i.force.x)/1e3}i + ${Math.round(1e3*i.force.y)/1e3}</div>`)}}this.required_half_size.set(0,0);for(const[,t]of this.nodes)this.recheckQuadtreeBounds(t,e),0===t.position_change.x&&0===t.position_change.y&&0!==t.alpha&&(t.alpha=Math.max(0,t.alpha-.1*t.alpha));this.drawable_selected?(this.ctx.canvas.style.cursor="pointer",this.debounceSelectedNodeAlphaReset.call(this.drawable_selected)):this.ctx.canvas.style.cursor="default"}addNode(t,e,i){if(this.nodes.has(t))return!1;const s=new mt(this,t,e,i);return this.nodes.set(t,s),this.debounceSelectedNodeAlphaReset.call(s),this.accumulated_alpha+=s.alpha,!0}handleMultiTouchMove(t){if(!this.pinching_to_zoom||2!==t.touches.length)return;if(!this.initial_touches)return void(this.initial_touches=t.touches);const e=(t,e)=>{const i=t.clientX-e.clientX,s=t.clientY-e.clientY;return Math.sqrt(i*i+s*s)},i=e(this.initial_touches[0],this.initial_touches[1]),s=e(t.touches[0],t.touches[1]);if(0===i)return;const n=s/i,a=b.clamp(this.camera.zoom*n,xt.MIN_ZOOM,xt.MAX_ZOOM),o=(t.touches[0].clientX+t.touches[1].clientX)/2*devicePixelRatio,r=(t.touches[0].clientY+t.touches[1].clientY)/2*devicePixelRatio,h=this.getTransformedPoint(o,r);this.camera.zoom=a;const c=this.getTransformedPoint(o,r);this.camera.x+=h.x-c.x,this.camera.y+=h.y-c.y,this.initial_touches=t.touches}handleMultiTouch(t){2===t.touches.length&&(this.pinching_to_zoom=!0)}handleMouseUp(){this.drawable_selected=null,this.dragging_camera=!1}zoomAt(t,e,i){const s=this.camera.zoom+xt.ZOOM_DELTA*this.camera.zoom*(i?1:-1);if(s>xt.MAX_ZOOM||s<xt.MIN_ZOOM)return;const n=this.camera.zoom,a=this.getTransformedPoint(t,e);this.animator.add(new et((i,s)=>{this.is_zooming=!s,this.camera.x=a.x-t/(devicePixelRatio*i),this.camera.y=a.y-e/(devicePixelRatio*i),this.camera.zoom=b.clamp(i,xt.MIN_ZOOM,xt.MAX_ZOOM)},n,s,100,Z.linear))}addEdge(t,e){const i=this.nodes.get(t),s=this.nodes.get(e);return!(!i||!s||(this.edges.get(rt.getEdgeKey(t,e))||(i.alpha=.5,s.alpha=.5,this.debounceSelectedNodeAlphaReset.call(i,s),this.edges.set(rt.getEdgeKey(t,e),new rt(this,i,s))),0))}handleMouseMove(t){const e=t instanceof MouseEvent?t:t.touches[0],i=this.getTransformedPoint(e.clientX*devicePixelRatio,e.clientY*devicePixelRatio),s=i.x-this.prev_mouse_pos.x,n=i.y-this.prev_mouse_pos.y;this.drawable_selected?(this.drawable_selected.pos.x+=s,this.drawable_selected.pos.y+=n,this.drawable_selected instanceof mt&&this.drawable_selected.position_change.set(s,n),this.prev_mouse_pos.set(i.x,i.y)):this.dragging_camera&&(this.camera.x-=s,this.camera.y-=n,wt.getReactiveLog("mouse translate point").set(`${i.x}i+${i.y}j`))}recheckQuadtreeBounds(t,e){if(!this.boundary_bounds.containsPoint(t.pos)){const i=300,s=t.pos.subtract(this.boundary_bounds.center),n=Math.abs(s.dot(nt.unit_x))+i,a=Math.abs(s.dot(nt.unit_y))+i,o=Math.max(n,this.required_half_size.width),r=Math.max(a,this.required_half_size.height);this.boundary_bounds.center.set(e.x,e.y),this.boundary_bounds.half_dimension.set(o,r),this.required_half_size.set(o,r),wt.getReactiveLog("Required size").set(this.required_half_size.toString()),this.bounds_updated=!0}}updateViewportFromScreen(t,e){const i=100,s=t,n=e,a=this.getTransformedPoint(0,0),o=this.getTransformedPoint(s,n),r=o.x-a.x,h=o.y-a.y;this.viewport.updateRect(a.x-i,a.y-i,r+i,h+i),this.bounds_updated=!0}handleMousePressed(t){if(!this.nodes)return;const e=t instanceof MouseEvent?t:t.touches[0],i=this.getTransformedPoint(e.clientX*devicePixelRatio,e.clientY*devicePixelRatio);this.prev_mouse_pos.set(i.x,i.y);for(const[,t]of this.nodes)if(t.containsPoint(i.x,i.y)){this.drawable_selected=t;break}this.drawable_selected||(this.dragging_camera=!0)}removeNode(t){return this.nodes.delete(t)}highlightNode(t){const e=this.nodes.get(t);return!!e&&(e.highlight(),!0)}unhighlightNode(t){return!1}moveNode(t,e,i){return!1}labelNode(t,e){return!1}removeEdge(t,e){return this.edges.delete(rt.getEdgeKey(t,e))}highlightEdge(t,e){const i=this.edges.get(rt.getEdgeKey(t,e));return!!i&&(i.highlight(),!0)}unhighlightEdge(t,e){return!1}labelEdge(t,e,i){return!1}noop(){return!0}finished(){return!1}error(t){return!1}reset(){return!1}clear(){return this.nodes.clear(),this.edges.clear(),!0}}xt.ZOOM_DELTA=.3,xt.MIN_ZOOM=.1,xt.MAX_ZOOM=10;const Nt=Math.pow(10,2),Et=0,Ct=1e4,Tt=1e4;function bt(t,e){const i=t.point.subtract(e.point),s=i.length_sqrd(),n=Math.atan2(i.y,i.x),a=Ct/(s+Nt)*e.mass*t.mass;return new nt(Math.round(a*Math.cos(n)),Math.round(a*Math.sin(n)))}function At(t,e){const i=t.radius+e.radius+Et,s=Math.pow(i,2),n=t.pos.subtract(e.pos),a=n.length_sqrd();if(a<.01)return ft;const o=Tt*(a-s);return{x:-Math.round(n.x/a*o),y:-Math.round(n.y/a*o)}}var Rt=function(t,e,i,s){return new(i||(i=Promise))(function(n,a){function o(t){try{h(s.next(t))}catch(t){a(t)}}function r(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,r)}h((s=s.apply(t,e||[])).next())})};class St{constructor(t){this.id=t}execute(t){return Rt(this,void 0,void 0,function*(){t.highlightNode(this.id)})}}class It{constructor(t,e){this.from_id=t,this.to_id=e}execute(t){return Rt(this,void 0,void 0,function*(){t.highlightEdge(this.from_id,this.to_id)})}}class Mt{execute(t){return Rt(this,void 0,void 0,function*(){t.finished()})}}class Lt{constructor(t,e){this.finished=!1,this.scene=t,this.step_time_ms=200,this.scene.start(),this.algorithm_name=e,this.generator=null,this.playing=!0}load(t){this.scene.clear();const e=new Set,i=document.getElementById("debug-data");i?i.textContent="":console.error("Debugging panel not found"),function(t,e,i=20){const s=e.ctx.canvas.getBoundingClientRect();let n=s.width/2,a=s.height/2,o=0,r=0,h=1,c=0,l=0,d=0;for(const s of t.getNodes()){let t=o*Math.cos(d)-0*Math.sin(d)+n,u=o*Math.sin(d)+0*Math.cos(d)+a;e.addNode(s,new nt(t,u),20),c++,d+=l,c===h&&(r++,o=2*i*r,d=0,c=0,l=Math.acos(1-1/(2*r*r)),h=Math.round(2*Math.PI/l))}}(t,this.scene);for(const s of t.getNodes()){if(i){const t=document.createElement("div");t.id=s.toString(),t.classList.add("node"),i.append(t)}for(const i of t.getNeighbors(s))this.scene.addEdge(s,i),e.add(i);e.add(s)}const s=function*(t,e){const i=[],s=[[null,e]];for(;s.length>0;){const e=s.pop(),n=e[0],a=e[1];if(!i.includes(a)){yield new It(n,a),yield new St(a),i.push(a);for(const e of t.getNeighbors(a))i.includes(e)||s.push([a,e])}}return new Mt}(t,t.start_node),n=setInterval(()=>{const t=s.next();t.done?clearInterval(n):t.value.execute(this.scene)},this.step_time_ms)}stop(){}reset(){}start(){}}class kt{constructor(t,e=!0){this.start_node=t,this.bidirectional=e,this.adjacency_mapping=new Map,this.addNode(t)}addNode(t){return this.adjacency_mapping.has(t)||this.adjacency_mapping.set(t,new Set),this}attach(t,e){var i;this.addNode(t);let s=this.adjacency_mapping.get(t);for(const n of e)this.addNode(n),null==s||s.add(n),this.bidirectional&&(null===(i=this.adjacency_mapping.get(n))||void 0===i||i.add(t));return this}getNeighbors(t){var e;return Array.from(null!==(e=this.adjacency_mapping.get(t))&&void 0!==e?e:[])}getNodes(){return Array.from(this.adjacency_mapping.keys())}toString(){let t="";for(const[e,i]of this.adjacency_mapping.entries())t+=`${e} → ${[...i].join(", ")}`;return t}}const Ot=new kt("A").attach("A",["B","C","D"]).attach("B",["E","F"]),Pt=new kt("Cluster1").attach("Cluster1",["C1A","C1B","C1C"]).attach("C1A",["C1B","C1C"]).attach("C1B",["C1C"]).attach("Cluster2",["C2A","C2B","C2C"]).attach("C2A",["C2B","C2C"]).attach("C2B",["C2C"]).attach("Cluster3",["C3A","C3B","C3C"]).attach("C3A",["C3B","C3C"]).attach("C3B",["C3C"]).attach("Cluster1",["Cluster2"]).attach("Cluster2",["Cluster3"]),Dt=new kt("Center").attach("Center",["N1","N2","N3","N4","N5","N6"]).attach("N1",["N2","N6"]).attach("N2",["N1","N3"]).attach("N3",["N2","N4"]).attach("N4",["N3","N5"]).attach("N5",["N4","N6"]).attach("N6",["N5","N1"]),Bt=new kt("C1N1").attach("C1N1",["C1N2","C1N3","C1N4"]).attach("C1N2",["C1N5","C1N6"]).attach("C1N3",["C1N7","C1N8"]).attach("C1N4",["C1N9","C1N10"]).attach("C2N1",["C2N2","C2N3","C2N4"]).attach("C2N2",["C2N5","C2N6"]).attach("C2N3",["C2N7","C2N8"]).attach("C2N4",["C2N9","C2N10"]).attach("C3N1",["C3N2","C3N3","C3N4"]).attach("C3N2",["C3N5","C3N6"]).attach("C3N3",["C3N7","C3N8"]).attach("C3N4",["C3N9","C3N10"]).attach("C4N1",["C4N2","C4N3","C4N4"]).attach("C4N2",["C4N5","C4N6"]).attach("C4N3",["C4N7","C4N8"]).attach("C4N4",["C4N9","C4N10"]).attach("C5N1",["C5N2","C5N3","C5N4"]).attach("C5N2",["C5N5","C5N6"]).attach("C5N3",["C5N7","C5N8"]).attach("C5N4",["C5N9","C5N10"]).attach("C6N1",["C6N2","C6N3","C6N4"]).attach("C6N2",["C6N5","C6N6"]).attach("C6N3",["C6N7","C6N8"]).attach("C6N4",["C6N9","C6N10"]).attach("C7N1",["C7N2","C7N3","C7N4"]).attach("C7N2",["C7N5","C7N6"]).attach("C7N3",["C7N7","C7N8"]).attach("C7N4",["C7N9","C7N10"]).attach("C8N1",["C8N2","C8N3","C8N4"]).attach("C8N2",["C8N5","C8N6"]).attach("C8N3",["C8N7","C8N8"]).attach("C8N4",["C8N9","C8N10"]).attach("C9N1",["C9N2","C9N3","C9N4"]).attach("C9N2",["C9N5","C9N6"]).attach("C9N3",["C9N7","C9N8"]).attach("C9N4",["C9N9","C9N10"]).attach("C10N1",["C10N2","C10N3","C10N4"]).attach("C10N2",["C10N5","C10N6"]).attach("C10N3",["C10N7","C10N8"]).attach("C10N4",["C10N9","C10N10"]).attach("C1N1",["C2N1"]).attach("C2N1",["C3N1"]).attach("C3N1",["C4N1"]).attach("C4N1",["C5N1"]).attach("C5N1",["C6N1"]).attach("C6N1",["C7N1"]).attach("C7N1",["C8N1"]).attach("C8N1",["C9N1"]).attach("C9N1",["C10N1"]);class Ut{}Ut.MIN_SCREEN_WIDTH=740;const Ft='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M5 19h2q.425 0 .713.288T8 20t-.288.713T7 21H4q-.425 0-.712-.288T3 20v-3q0-.425.288-.712T4 16t.713.288T5 17zm14 0v-2q0-.425.288-.712T20 16t.713.288T21 17v3q0 .425-.288.713T20 21h-3q-.425 0-.712-.288T16 20t.288-.712T17 19zM5 5v2q0 .425-.288.713T4 8t-.712-.288T3 7V4q0-.425.288-.712T4 3h3q.425 0 .713.288T8 4t-.288.713T7 5zm14 0h-2q-.425 0-.712-.288T16 4t.288-.712T17 3h3q.425 0 .713.288T21 4v3q0 .425-.288.713T20 8t-.712-.288T19 7z"/></svg>',zt='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M6 18H4q-.425 0-.712-.288T3 17t.288-.712T4 16h3q.425 0 .713.288T8 17v3q0 .425-.288.713T7 21t-.712-.288T6 20zm12 0v2q0 .425-.288.713T17 21t-.712-.288T16 20v-3q0-.425.288-.712T17 16h3q.425 0 .713.288T21 17t-.288.713T20 18zM6 6V4q0-.425.288-.712T7 3t.713.288T8 4v3q0 .425-.288.713T7 8H4q-.425 0-.712-.288T3 7t.288-.712T4 6zm12 0h2q.425 0 .713.288T21 7t-.288.713T20 8h-3q-.425 0-.712-.288T16 7V4q0-.425.288-.712T17 3t.713.288T18 4z"/></svg>';document.addEventListener("DOMContentLoaded",()=>{let t=!0;const e=document.getElementById("canvas-container"),i=document.getElementById("main-canvas"),s=i.getContext("2d",{alpha:!1});if(!i)return;if(!s)return;const n=document.getElementById("toggle-btn"),a=document.getElementById("data-container"),o=document.getElementById("slider"),r=new xt(s,!0);function h(){window.innerWidth>Ut.MIN_SCREEN_WIDTH?(null==e||e.classList.remove("hidden"),null==a||a.classList.remove("hidden"),t=!0):t?(null==e||e.classList.remove("hidden"),null==a||a.classList.add("hidden"),t=!0):(null==e||e.classList.add("hidden"),null==a||a.classList.remove("hidden"),t=!1),window.innerWidth<=Ut.MIN_SCREEN_WIDTH&&(t?r.start():r.stop())}function c(t){if(!e)return;const i=window.devicePixelRatio||1,s=e.getBoundingClientRect(),n=t.getTransform();t.canvas.width=Math.round(s.width*i),t.canvas.height=Math.round(s.height*i),t.setTransform(n),wt.getReactiveLog("CanvasSize").set(`${t.canvas.offsetWidth}x${t.canvas.offsetHeight}`),wt.getReactiveLog("CanvasContainerSize").set(`${e.offsetWidth}x${e.offsetHeight}`),r.render()}!function(){const t=document.getElementById("fullscreen-btn");let e=!1;null==t||t.addEventListener("click",()=>{e=null!==document.fullscreenElement,e?document.exitFullscreen().then(()=>{t.innerHTML=Ft,e=!1}):document.body.requestFullscreen().then(()=>{t.innerHTML=zt,e=!0})}),document.body.addEventListener("fullscreenchange",i=>{e=null!==document.fullscreenElement,t.innerHTML=e?zt:Ft})}(),window.addEventListener("resize",()=>{e.style.width="",h(),c(s)}),window.addEventListener("orientationchange",()=>{e.style.width="",h(),c(s)});let l=!1;null==o||o.addEventListener("mousedown",()=>{document.body.style.cursor="ew-resize",l=!0}),null==o||o.addEventListener("touchstart",()=>{l=!0}),window.addEventListener("mouseup",()=>{l=!1,document.body.style.cursor="default",c(s)}),window.addEventListener("touchend",()=>{l=!1,c(s)}),window.addEventListener("mousemove",t=>{if(e&&!(window.innerWidth<=Ut.MIN_SCREEN_WIDTH)&&l&&t.clientX<window.innerWidth&&t.clientX>0){const i=t.pageX;e.style.width=`${i}px`,c(s),t.preventDefault(),t.stopImmediatePropagation()}}),window.addEventListener("touchmove",t=>{const i=t.touches[0];if(e&&!(window.innerWidth<=Ut.MIN_SCREEN_WIDTH)&&l&&i.clientX<window.innerWidth&&i.clientX>0){const n=i.pageX;e.style.width=`${n}px`,c(s),t.preventDefault(),t.stopImmediatePropagation()}}),null==n||n.addEventListener("click",()=>{t?(null==e||e.classList.add("hidden"),null==a||a.classList.remove("hidden")):(null==e||e.classList.remove("hidden"),null==a||a.classList.add("hidden")),t=!t,t?r.start():r.stop()}),st.setThemeType($.AUTO),e&&o&&window.innerWidth>Ut.MIN_SCREEN_WIDTH&&(e.style.width=`${o.getBoundingClientRect().x}px`),c(s),h();const d=new Lt(r,"DFS Graph Traversal"),u=document.getElementById("config-dropdown");if(u){const t={simple:Ot,"clustered small":Pt,"spider web":Dt,"large clustered":Bt};for(const e in t){const t=document.createElement("option");t.innerText=e,u.appendChild(t)}u.value=u.options[3].value,d.load(t[u.value]),u.addEventListener("change",()=>{d.load(t[u.value]),console.log("changing")}),function(){const t=document.getElementById("yasl-repl");new j(t)}()}})})();